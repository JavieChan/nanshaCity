/*! nanshacity_v2 author:JavieChan create:2016-01-11 updated:2016-08-30 */
function chartAjax(a,b,c){$.ajax({method:"get",url:proUrl+"datamap/"+a,data:{location:77201},dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}function chartAjax(a,b,c){$.ajax({method:"get",url:proUrl+"datamap/"+a,data:{location:77201},dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}function perfectSize(){var a=$(window).height()-60,b=a>826?a:826,c=Math.floor((b-70-44-10)/2);$(".block").css({height:b+"px"}),$(".blockChartTop, .blockChartBottom, .htq").css({height:c+"px"})}function townVillageRank(a){for(var b=0,c="",d="";b<a.length;b++){var e=a[b];c+='<div class="fst"><span title="'+e.name+'">'+e.name+"</span><em>"+e.conns+"</em></div>",d='<div class="sec">';for(var f=0;f<e.villages.length;f++){var g=e.villages[f];d+="<div><span>"+g[0]+"</span><em>"+g[1]+"</em></div>"}d+="</div>",c+=d}return c}function randomNum(a,b){var c=b-a,d=Math.random(),e=a+Math.ceil(d*c);return e}function generateData(){var a,b=[],c=(new Date).getTime();for(a=-4;0>=a;a+=1)b.push({x:c+1e3*a,y:Math.round(100*Math.random())+10});return b}function loadPieB(a){var b=a.series[0];intPB=setInterval(function(){var a=[],c=randomNum(pieArrB[0]+1,pieArrB[0]+5);a.push(["新用户",c],["老用户",100-c]),b.setData(a)},3e3)}function loadPieC(a){var b=a.series[0];intPC=setInterval(function(){var a=[],c=randomNum(pieArrC[1]+1,pieArrC[1]+3);a.push(["手机",100-c],["PC",c]),b.setData(a)},3e3)}var proUrl="/",proUrl="/",intPB,intPC,intMem,chartFlag=!0,chartA,chartB,chartC,xarea,dataOnline,onlinePieA=[],onlinePieB=[],onlinePieC=[],onlineLineA=[],onlineLineB=[],onlineLineC=[],area24=[],clmn={},pieArrB=[],pieArrC=[],colorStep=[["#71cd6f","#eeb636"],["#5befb2","#3ec6ff","#6b8eff"],["#71cd6f","#e2c966","#3b97ff"],["#eb5e2a","#ec8622","#b26dff","#e2d653","#56e3a9","#3ec6ff","#a7e043","#747eff","#fff"]],pieNames=["热点状态","用户类型","连接终端","人流预警","人口密度"];$(function(){function a(a,c){if(onlinePieA=[],onlinePieB=[],onlinePieC=[],onlineLineA=[],onlineLineB=[],onlineLineC=[],area24=[],$(".slimScroll ul li").remove(),0==c){$("#onlineSlimScroll .scrollbar").html(townVillageRank(a.town_user_rank)),$("#onlineSlimScroll").slimScroll({height:"536px",width:"270px"}),$(".online .blockInfo em:eq(0)").text(a.ap_count),$(".online .blockInfo em:eq(1)").text(a.ap_offline_count),$(".online .blockInfo em:eq(2)").text(a.online_user),$(".online .blockInfo em:eq(3)").text(parseInt(45.6*a.online_user)),intMem=setInterval(function(){$(".online .blockInfo em:eq(2)").text(randomNum(a.online_user-6,a.online_user+7))},5e3);var d=a.ap_online_status.online_count,e=a.ap_online_status.offline_count,f=a.usage_status["new"],g=a.usage_status.old,h=a.device_status.mobile_count,i=a.device_status.pc_count,j=parseInt(f/(f+g)*100),k=parseInt(h/(h+i)*100);onlinePieA.push(["在线",d],["离线",e]),onlinePieB.push(["新用户",j],["老用户",100-j]),onlinePieC.push(["手机",k],["PC",100-k]),pieArrB=[j,100-j],pieArrC=[k,100-k],onlineLineA.push({name:"在线",color:colorStep[0][0],data:a.ap_online_chart_data.online},{name:"离线",color:colorStep[0][1],data:a.ap_online_chart_data.offline}),onlineLineB.push({name:"新用户",color:colorStep[1][0],data:a.usage_chart_data["new"]},{name:"老用户",color:colorStep[1][1],data:a.usage_chart_data.old}),onlineLineC.push({name:"手机",color:colorStep[2][0],data:a.device_chart_data.mobile},{name:"PC",color:colorStep[2][1],data:a.device_chart_data.pc});var l=[];$.each(a.traffic_chart_data,function(a,b){14>=a?l.push([a+1,randomNum(100*(a+1)+700,100*(a+1)+800)]):l.push([a+1,randomNum(2e3,2200)])}),area24.push({name:"用户流量",color:"#276089",lineColor:"#00f6ff",data:l});var m=[],n=[],o=[],p=[];$.each(a.town_conns,function(a,b){$.each(b,function(a,b){p.push(a),m.push(b[0]),n.push(b[1]),o.push(b[2])})}),clmn.towns=p,clmn.ds=[{name:"昨天",color:colorStep[3][5],data:m},{name:"当前",color:colorStep[3][6],data:n},{name:"历史最高",color:colorStep[3][4],data:o}],chartA=new Highcharts.Chart(b.optionPie("onlinePieA",onlinePieA,colorStep[0],pieNames[0],"个")),chartB=new Highcharts.Chart(b.optionPie("onlinePieB",onlinePieB,colorStep[1],pieNames[1],"%",loadPieB)),chartC=new Highcharts.Chart(b.optionPie("onlinePieC",onlinePieC,colorStep[2],pieNames[2],"%",loadPieC)),xarea=new Highcharts.Chart(b.optionColumn("Xline",clmn))}}chartAjax("overview",function(a){200==a.code&&($(".dataOvi table tr:eq(1) td").each(function(b,c){$(c).text(a.ap_count[b])}),$(".dataOvi table tr:eq(2) td").each(function(b,c){$(c).text(a.ap_offline_count[b])}),$(".dataOvi table tr:eq(3) td").each(function(b,c){$(c).text(a.online[b])}),$(".dataOvi table tr:eq(4) td").each(function(b,c){$(c).text(a.traffic[b])}),$(".dataOvi table tr:eq(5) td").each(function(b,c){$(c).text(a.app[b])}),$(".dataOvi table tr:eq(6) td").each(function(b,c){$(c).text(a.message[b])}))}),chartAjax("general",function(b){200==b.code&&(dataOnline=b,a(dataOnline,0))}),perfectSize(),setInterval(function(){chartAjax("general",function(a){200==a.code&&(dataOnline=a)})},36e5),Highcharts.setOptions({global:{useUTC:!1}});var b={optionPie:function(a,b,c,d,e,f){var g={chart:{renderTo:a,type:"pie",options3d:{enabled:!0,alpha:15},backgroundColor:"transparent",style:{color:"#fff"},events:{load:function(){"function"==typeof f&&f(this)}}},title:{text:d,style:{fontSize:"14px",color:"#c3f1f7"}},colors:c,credits:{enabled:!1},legend:{itemStyle:{fontSize:"16px",fontWeight:"normal"},itemHoverStyle:{fontSize:"16px",fontWeight:"normal"},symbolRadius:6,symbolWidth:12,symbolHeight:12},tooltip:{formatter:function(){return this.key+": "+this.y+e}},plotOptions:{pie:{allowPointSelect:!0,depth:25,showInLegend:!0,borderWidth:0,point:{events:{click:function(){this.options.url&&(location.href=this.options.url)}}}},series:{dataLabels:{align:"center",color:"#fff",style:{fontSize:"18px",fontWeight:"normal"},format:"{y}"+e,distance:1}}},series:[{data:b}]};return g},optionArea:function(a,b){var c={chart:{type:"area",renderTo:a,backgroundColor:"transparent",spacing:[20,20,20,20]},title:{text:"用户流量统计",style:{color:"#dffeff",fontSize:"16px"},align:"left"},credits:{enabled:!1},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+":00</b><br />"+this.series.name+": "+this.y+"M/H"}},xAxis:{minPadding:0,maxPadding:0,allowDecimals:!1,labels:{format:"{value}:00",style:{color:"#dffeff",fontSize:"16px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{format:"{value}M/H",style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{area:{marker:{enabled:!1}}},series:b};return c},optionLine:function(a,b,c,d,e){var f={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[10,20,5,20],animation:Highcharts.svg,events:{load:function(){"function"==typeof e&&e(this)}}},title:{text:c,style:{fontSize:"14px",color:"#c3f1f7"}},credits:{enabled:!1},legend:{itemStyle:{fontSize:"16px",fontWeight:"normal"},itemHoverStyle:{fontSize:"16px",fontWeight:"normal"}},tooltip:{formatter:function(){return"<b>"+this.x+":00</b><br />"+this.series.name+": "+this.y+d}},xAxis:{allowDecimals:!1,labels:{format:"{value}:00",style:{color:"#fff",fontSize:"14px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return f},optionLineX:function(a,b){var c={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[20,20,20,20],animation:Highcharts.svg},title:{text:"各镇连接人数实时统计",style:{color:"#dffeff",fontSize:"14px"},align:"left"},credits:{enabled:!1},legend:{itemStyle:{fontSize:"14px",fontWeight:"normal"},itemHoverStyle:{fontSize:"14px",fontWeight:"normal"}},tooltip:{formatter:function(){return this.series.name+": "+this.y+"人"}},xAxis:{allowDecimals:!1,labels:{style:{color:"#dffeff",fontSize:"16px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return c},optionColumn:function(a,b){var c={chart:{renderTo:a,type:"column",backgroundColor:"transparent",spacing:[20,20,20,20]},title:{text:"各镇连接人数实时统计",style:{color:"#dffeff",fontSize:"14px"},align:"left"},credits:{enabled:!1},legend:{itemStyle:{fontSize:"14px",fontWeight:"normal"},itemHoverStyle:{fontSize:"14px",fontWeight:"normal"}},tooltip:{headerFormat:'<span style="font-size:14px;line-height:2">{point.key}</span><table style="font-size:14px">',pointFormat:'<tr><td style="color:{series.color}">{series.name}: </td><td style="padding-left:10px"><b>{point.y} 人</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},xAxis:{categories:b.towns,labels:{style:{color:"#dffeff",fontSize:"16px"}},crosshair:!0,tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:b.ds};return c}};$(document).on("click","header span button",function(){$(".block").is(":hidden")?($(this).addClass("on"),$(".blockCtx").hide(),$(".blockCtx:eq(0)").show(),$(".blockNavBtns button:eq(0)").addClass("on").siblings().removeClass("on"),$(".blockChartBottom .asidebtns button:eq(1)").addClass("on").siblings().removeClass("on"),$(".mapbtn").html("热点地图"),$(".block").slideDown(500),a(dataOnline,0)):(clearInterval(intMem),clearInterval(intPB),clearInterval(intPC),$(".mapbtn").html('<i class="dataIco"></i>数据统计'),$(".block").slideUp(500),$(this).removeClass("on"))}),$(document).on("click",".dataOvi h3",function(){$("header span button").addClass("on"),$(".blockCtx").hide(),$(".blockCtx:eq(0)").show(),$(".blockNavBtns button:eq(0)").addClass("on").siblings().removeClass("on"),$(".blockChartBottom .asidebtns button:eq(1)").addClass("on").siblings().removeClass("on"),$(".mapbtn").html("热点地图"),$(".block").slideDown(500),a(dataOnline,0)}),$(document).on("click",".blockNavBtns button",function(){if($(this).hasClass("on"))return!1;var b=$(this).index(),c=$(this).html();b>0&&msgBox("此模块开发中..."),chartFlag=!0,$(this).addClass("on").siblings().removeClass("on"),$(".changeChart").text("切换坐标"),$(".blockChartBottom .btn:eq(1)").addClass("on").siblings().removeClass("on"),$(".blockTab h2").html(c),$(".blockCtx").hide().eq(b).show(),0==b&&a(dataOnline,0)}),$(document).on("click",".online .blockChartTop .changeChart",function(){chartFlag?(clearInterval(intMem),clearInterval(intPB),clearInterval(intPC),$(this).text("切换饼图"),chartA=new Highcharts.Chart(b.optionLine("onlinePieA",onlineLineA,pieNames[0],"个")),chartB=new Highcharts.Chart(b.optionLine("onlinePieB",onlineLineB,pieNames[1],"人")),chartC=new Highcharts.Chart(b.optionLine("onlinePieC",onlineLineC,pieNames[2],"台")),chartFlag=!1):($(this).text("切换坐标"),chartA=new Highcharts.Chart(b.optionPie("onlinePieA",onlinePieA,colorStep[0],pieNames[0],"个")),chartB=new Highcharts.Chart(b.optionPie("onlinePieB",onlinePieB,colorStep[1],pieNames[1],"%",loadPieB)),chartC=new Highcharts.Chart(b.optionPie("onlinePieC",onlinePieC,colorStep[2],pieNames[2],"%",loadPieC)),chartFlag=!0)}),$(document).on("click",".online .blockChartBottom .asidebtns button",function(){if($(this).hasClass("on"))return!1;$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();xarea=0==a?new Highcharts.Chart(b.optionArea("Xline",area24)):new Highcharts.Chart(b.optionColumn("Xline",clmn))}),$(document).on("click",".townVillage button",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();$(this).parents(".blockRank").find(".slimScroll ul").hide(),$(this).parents(".blockRank").find(".slimScroll ul").eq(a).show()}),$(document).on("mouseenter",".slimScroll .fst",function(){$(this).prepend('<i class="clickIco"></i>').siblings().find(".clickIco").remove()}),$(document).on("click",".slimScroll .fst",function(){$(this).next(".sec").is(":hidden")?($(".sec").slideUp(),$(this).next(".sec").slideDown()):$(this).next(".sec").slideUp()}),window.onresize=function(){perfectSize()},$("#mapNav li").on("click",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).data("lnglat").split(",");map.setZoomAndCenter(13,a)})});
/*! nanshacity_v2 JavieChan */