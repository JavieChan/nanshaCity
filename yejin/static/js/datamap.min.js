function chartAjax(a,b,c){$.ajax({method:"get",url:proUrl+"datamap/"+a,data:{location:77201},dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}function perfectSize(){var a=$(window).height()-60,b=a>826?a:826,c=Math.floor((b-70-44-10)/2);$(".block").css({height:b+"px"}),$(".blockChartTop, .blockChartBottom, .htq").css({height:c+"px"})}function townVillageRank(a){for(var b=0,c="",d="";b<a.length;b++){var e=a[b];c+='<div class="fst"><span title="'+e.name+'">'+e.name+"</span><em>"+e.conns+"</em></div>",d='<div class="sec">';for(var f=0;f<e.villages.length;f++){var g=e.villages[f];d+="<div><span>"+g[0]+"</span><em>"+g[1]+"</em></div>"}d+="</div>",c+=d}return c}function randomNum(a,b){var c=b-a,d=Math.random(),e=a+Math.ceil(d*c);return e}function loadPieB(a){var b=a.series[0];intPB=setInterval(function(){var a=[],c=[];$.each(pieArrB,function(a,b){c.push(randomNum(b+1,b+3))}),$.each(onlinePieB,function(b,d){a.push([d[0],c[b]])}),b.setData(a)},3e3)}var proUrl="/",intPB,intPC,intMem,chartFlag=!0,chartA,chartB,chartC,xarea,dataOnline,onlinePieA=[],onlinePieB=[],onlinePieC=[],onlineLineA=[],onlineLineB=[],onlineLineC=[],area24=[],clmn={},pieArrB=[],colorStep=[["#71cd6f","#eeb636"],["#5befb2","#3ec6ff","#6b8eff"],["#71cd6f","#e2c966","#3b97ff","#b26dff"],["#eb5e2a","#ec8622","#b26dff","#e2d653","#56e3a9","#3ec6ff","#a7e043","#747eff","#fff"]],pieNames=["热点状态","各镇街在线人数","连接终端","人流预警","人口密度"];$(function(){function a(a,b){if(onlinePieA=[],onlinePieB=[],onlinePieC=[],onlineLineA=[],onlineLineB=[],onlineLineC=[],area24=[],$(".slimScroll ul li").remove(),0==b){var c=a.ap_online_status.online_count,d=a.ap_online_status.offline_count,e=a.device_status.pc_count,f=a.device_status.android_count,g=a.device_status.ios_count,h=a.device_status.wechat_count;$.each(a.town_conns_status,function(a,b){pieArrB.push(b),onlinePieB.push([a,b])}),onlinePieA.push(["在线",c],["离线",d]);var i=e+f+g+h;onlinePieC.push(["安卓",parseInt(f/i*100)],["IOS",100-(parseInt(f/i*100)+parseInt(h/i*100)+parseInt(e/i*100))],["微信",parseInt(h/i*100)],["PC",parseInt(e/i*100)]),onlineLineA.push({name:"在线",color:colorStep[0][0],data:a.ap_online_chart_data.online},{name:"离线",color:colorStep[0][1],data:a.ap_online_chart_data.offline});var j=[],k=[];$.each(a.town_conns_chart_data,function(a,b){j.push(a),k.push(b)});for(var l=0;l<j.length;l++)onlineLineB.push({name:j[l],color:colorStep[3][l],data:k[l]});onlineLineC.push({name:"安卓",color:colorStep[2][0],data:a.device_chart_data.android},{name:"IOS",color:colorStep[2][1],data:a.device_chart_data.ios},{name:"微信",color:colorStep[2][2],data:a.device_chart_data.wechat},{name:"PC",color:colorStep[2][3],data:a.device_chart_data.pc}),area24.push({name:"用户流量",color:"#276089",lineColor:"#00f6ff",data:a.traffic_chart_data});var m=[],n=[],o=[],p=[];$.each(a.town_conns,function(a,b){$.each(b,function(a,b){p.push(a),m.push(b[0]),n.push(b[1]),o.push(b[2])})}),clmn.towns=p,clmn.ds=[{name:"当前",color:colorStep[3][5],data:n},{name:"昨天最高",color:colorStep[3][6],data:m},{name:"历史最高",color:colorStep[3][4],data:o}]}}var b=function(){chartAjax("overview",function(a){200==a.code&&($(".dataOvi table tr:eq(1) td").each(function(b,c){$(c).text(a.ap_count[b])}),$(".dataOvi table tr:eq(2) td").each(function(b,c){$(c).text(a.ap_offline_count[b])}),$(".dataOvi table tr:eq(3) td").each(function(b,c){$(c).text(a.online[b])}),$(".dataOvi table tr:eq(4) td").each(function(b,c){$(c).text(a.traffic[b])}),$(".dataOvi table tr:eq(5) td").each(function(b,c){$(c).text(a.app[b])}),$(".dataOvi table tr:eq(6) td").each(function(b,c){$(c).text(a.message[b])}))})};b(),chartAjax("general",function(b){if(200==b.code){a(b,0);var c=b;$("#onlineSlimScroll .scrollbar").html(townVillageRank(c.town_user_rank)),$("#onlineSlimScroll").slimScroll({height:"536px",width:"270px"}),$(".online .blockInfo em:eq(0)").text(c.ap_count),$(".online .blockInfo em:eq(1)").text(c.ap_offline_count),$(".online .blockInfo em:eq(2)").text(c.total_user),$(".online .blockInfo em:eq(3)").text(c.online_user),$(".online .blockInfo em:eq(4)").text(parseInt(c.traffic)),intMem=setInterval(function(){$(".online .blockInfo em:eq(3)").text(randomNum(c.online_user-6,c.online_user+7))},5e3)}}),perfectSize(),setInterval(function(){b(),chartAjax("general",function(b){if(200==b.code){a(b,0);var c=b;if($("#onlineSlimScroll .scrollbar").html(townVillageRank(c.town_user_rank)),$("#onlineSlimScroll").slimScroll({height:"536px",width:"270px"}),$(".online .blockInfo em:eq(0)").text(c.ap_count),$(".online .blockInfo em:eq(1)").text(c.ap_offline_count),$(".online .blockInfo em:eq(2)").text(c.total_user),$(".online .blockInfo em:eq(3)").text(c.online_user),$(".online .blockInfo em:eq(4)").text(parseInt(c.traffic)),clearInterval(intMem),intMem=setInterval(function(){$(".online .blockInfo em:eq(3)").text(randomNum(c.online_user-6,c.online_user+7))},5e3),!$(".block").is(":hidden")){if(chartFlag)chartA.series[0].setData(onlinePieA),chartB.series[0].setData(onlinePieB),chartC.series[0].setData(onlinePieC);else{chartA.series[0].setData(c.ap_online_chart_data.online),chartA.series[1].setData(c.ap_online_chart_data.offline);for(var d=0;d<chartB.series.length;d++)chartB.series[d].setData(onlineLineB[d].data);chartC.series[0].setData(c.device_chart_data.android),chartC.series[1].setData(c.device_chart_data.ios),chartC.series[2].setData(c.device_chart_data.wechat),chartC.series[3].setData(c.device_chart_data.pc)}if(0==$(".online .blockChartBottom .asidebtns button.on").index())xarea.series[0].setData(c.traffic_chart_data);else{for(var d=0;d<3;d++)xarea.series[d].setData(clmn.ds[d].data);xarea.xAxis[0].setCategories(clmn.towns)}}}})},12e4),Highcharts.setOptions({global:{useUTC:!1}});var c={optionPie:function(a,b,c,d,e,f){var g={chart:{renderTo:a,type:"pie",options3d:{enabled:!0,alpha:15},backgroundColor:"transparent",style:{color:"#fff"},events:{load:function(){"function"==typeof f&&f(this)}}},title:{text:d,style:{fontSize:"14px",color:"#c3f1f7"}},colors:c,credits:{enabled:!1},legend:{itemStyle:{fontSize:"16px",fontWeight:"normal"},itemHoverStyle:{fontSize:"16px",fontWeight:"normal"},symbolRadius:6,symbolWidth:12,symbolHeight:12},tooltip:{formatter:function(){return this.key+": "+this.y+e}},plotOptions:{pie:{allowPointSelect:!0,depth:25,showInLegend:!0,borderWidth:0,point:{events:{click:function(){this.options.url&&(location.href=this.options.url)}}}},series:{dataLabels:{align:"center",color:"#fff",style:{fontSize:"18px",fontWeight:"normal"},format:"{y}"+e,distance:1}}},series:[{data:b}]};return g},optionPieMore:function(a,b,c,d,e,f){var g={chart:{renderTo:a,type:"pie",options3d:{enabled:!0,alpha:15},backgroundColor:"transparent",style:{color:"#fff"},events:{load:function(){"function"==typeof f&&f(this)}}},title:{text:d,style:{fontSize:"14px",color:"#c3f1f7"}},colors:c,credits:{enabled:!1},legend:{itemWidth:75,itemStyle:{fontSize:"12px",fontWeight:"normal"},itemHoverStyle:{fontSize:"12px",fontWeight:"normal"},symbolRadius:4,symbolWidth:8,symbolHeight:8},tooltip:{formatter:function(){return this.key+": "+this.y+e}},plotOptions:{pie:{allowPointSelect:!0,depth:25,showInLegend:!0,borderWidth:0,point:{events:{click:function(){this.options.url&&(location.href=this.options.url)}}}},series:{dataLabels:{align:"center",color:"#fff",style:{fontSize:"14px",fontWeight:"normal"},format:"{y}"+e,distance:1}}},series:[{data:b}]};return g},optionArea:function(a,b){var c={chart:{type:"area",renderTo:a,backgroundColor:"transparent",spacing:[20,20,20,20]},title:{text:"用户流量统计",style:{color:"#dffeff",fontSize:"16px"},align:"left"},credits:{enabled:!1},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+":00</b><br />"+this.series.name+": "+this.y+"M/H"}},xAxis:{minPadding:0,maxPadding:0,allowDecimals:!1,labels:{format:"{value}:00",style:{color:"#dffeff",fontSize:"16px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{format:"{value}M/H",style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{area:{marker:{enabled:!1}}},series:b};return c},optionLine:function(a,b,c,d,e){var f={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[10,20,5,20],animation:Highcharts.svg,events:{load:function(){"function"==typeof e&&e(this)}}},title:{text:c,style:{fontSize:"14px",color:"#c3f1f7"}},credits:{enabled:!1},legend:{itemStyle:{fontSize:"16px",fontWeight:"normal"},itemHoverStyle:{fontSize:"16px",fontWeight:"normal"}},tooltip:{formatter:function(){return"<b>"+this.x+":00</b><br />"+this.series.name+": "+this.y+d}},xAxis:{allowDecimals:!1,labels:{format:"{value}:00",style:{color:"#fff",fontSize:"14px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return f},optionLineMore:function(a,b,c,d,e){var f={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[10,20,5,20],animation:Highcharts.svg,events:{load:function(){"function"==typeof e&&e(this)}}},title:{text:c,style:{fontSize:"14px",color:"#c3f1f7"}},credits:{enabled:!1},legend:{itemWidth:80,itemStyle:{fontSize:"12px",fontWeight:"normal"},itemHoverStyle:{fontSize:"12px",fontWeight:"normal"},symbolWidth:10},tooltip:{formatter:function(){return"<b>"+this.x+":00</b><br />"+this.series.name+": "+this.y+d}},xAxis:{allowDecimals:!1,labels:{format:"{value}:00",style:{color:"#fff",fontSize:"12px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return f},optionLineX:function(a,b){var c={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[20,20,20,20],animation:Highcharts.svg},title:{text:"各镇连接人数实时统计",style:{color:"#dffeff",fontSize:"14px"},align:"left"},credits:{enabled:!1},legend:{itemStyle:{fontSize:"14px",fontWeight:"normal"},itemHoverStyle:{fontSize:"14px",fontWeight:"normal"}},tooltip:{formatter:function(){return this.series.name+": "+this.y+"人"}},xAxis:{allowDecimals:!1,labels:{style:{color:"#dffeff",fontSize:"16px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return c},optionColumn:function(a,b){var c={chart:{renderTo:a,type:"column",backgroundColor:"transparent",spacing:[20,20,20,20]},title:{text:"各镇连接人数实时统计",style:{color:"#dffeff",fontSize:"14px"},align:"left"},credits:{enabled:!1},legend:{itemStyle:{fontSize:"14px",fontWeight:"normal"},itemHoverStyle:{fontSize:"14px",fontWeight:"normal"}},tooltip:{headerFormat:'<span style="font-size:14px;line-height:2">{point.key}</span><table style="font-size:14px">',pointFormat:'<tr><td style="color:{series.color}">{series.name}: </td><td style="padding-left:10px"><b>{point.y} 人</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},xAxis:{categories:b.towns,labels:{style:{color:"#dffeff",fontSize:"16px"}},crosshair:!0,tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:b.ds};return c}};$(document).on("click","header span button",function(){$(".block").is(":hidden")?($(".blockCtx").hide(),$(".blockCtx:eq(0)").show(),$(".blockNavBtns button:eq(0)").addClass("on").siblings().removeClass("on"),$(".blockChartBottom .asidebtns button:eq(1)").addClass("on").siblings().removeClass("on"),$(".mapbtn").html("热点地图"),$(".block").slideDown(500),chartA=new Highcharts.Chart(c.optionPie("onlinePieA",onlinePieA,colorStep[0],pieNames[0],"个")),chartB=new Highcharts.Chart(c.optionPieMore("onlinePieB",onlinePieB,colorStep[3],pieNames[1],"人",loadPieB)),chartC=new Highcharts.Chart(c.optionPie("onlinePieC",onlinePieC,colorStep[2],pieNames[2],"%")),xarea=new Highcharts.Chart(c.optionColumn("Xline",clmn))):(clearInterval(intMem),clearInterval(intPB),$(".mapbtn").html('<i class="dataIco"></i>数据统计'),$(".block").slideUp(500))}),$(document).on("click",".dataOvi h3",function(){$(".blockCtx").hide(),$(".blockCtx:eq(0)").show(),$(".blockNavBtns button:eq(0)").addClass("on").siblings().removeClass("on"),$(".blockChartBottom .asidebtns button:eq(1)").addClass("on").siblings().removeClass("on"),$(".mapbtn").html("热点地图"),$(".block").slideDown(500),chartA=new Highcharts.Chart(c.optionPie("onlinePieA",onlinePieA,colorStep[0],pieNames[0],"个")),chartB=new Highcharts.Chart(c.optionPieMore("onlinePieB",onlinePieB,colorStep[3],pieNames[1],"人",loadPieB)),chartC=new Highcharts.Chart(c.optionPie("onlinePieC",onlinePieC,colorStep[2],pieNames[2],"%")),xarea=new Highcharts.Chart(c.optionColumn("Xline",clmn))}),$(document).on("click",".blockNavBtns button",function(){if($(this).hasClass("on"))return!1;var a=$(this).index(),b=$(this).html();a>0&&msgBox("此模块开发中..."),chartFlag=!0,$(this).addClass("on").siblings().removeClass("on"),$(".changeChart").text("切换坐标"),$(".blockChartBottom .btn:eq(1)").addClass("on").siblings().removeClass("on"),$(".blockTab h2").html(b),$(".blockCtx").hide().eq(a).show(),0==a&&($(".msgbox").hide(),chartA=new Highcharts.Chart(c.optionPie("onlinePieA",onlinePieA,colorStep[0],pieNames[0],"个")),chartB=new Highcharts.Chart(c.optionPieMore("onlinePieB",onlinePieB,colorStep[3],pieNames[1],"人",loadPieB)),chartC=new Highcharts.Chart(c.optionPie("onlinePieC",onlinePieC,colorStep[2],pieNames[2],"%")),xarea=new Highcharts.Chart(c.optionColumn("Xline",clmn)))}),$(document).on("click",".online .blockChartTop .changeChart",function(){chartFlag?(clearInterval(intMem),clearInterval(intPB),clearInterval(intPC),$(this).text("切换饼图"),chartA=new Highcharts.Chart(c.optionLine("onlinePieA",onlineLineA,pieNames[0],"个")),chartB=new Highcharts.Chart(c.optionLineMore("onlinePieB",onlineLineB,pieNames[1],"人")),chartC=new Highcharts.Chart(c.optionLine("onlinePieC",onlineLineC,pieNames[2],"台")),chartFlag=!1):($(this).text("切换坐标"),chartA=new Highcharts.Chart(c.optionPie("onlinePieA",onlinePieA,colorStep[0],pieNames[0],"个")),chartB=new Highcharts.Chart(c.optionPieMore("onlinePieB",onlinePieB,colorStep[3],pieNames[1],"人",loadPieB)),chartC=new Highcharts.Chart(c.optionPie("onlinePieC",onlinePieC,colorStep[2],pieNames[2],"%")),chartFlag=!0)}),$(document).on("click",".online .blockChartBottom .asidebtns button",function(){if($(this).hasClass("on"))return!1;$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();xarea=0==a?new Highcharts.Chart(c.optionArea("Xline",area24)):new Highcharts.Chart(c.optionColumn("Xline",clmn))}),$(document).on("click",".townVillage button",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();$(this).parents(".blockRank").find(".slimScroll ul").hide(),$(this).parents(".blockRank").find(".slimScroll ul").eq(a).show()}),$(document).on("mouseenter",".slimScroll .fst",function(){$(this).prepend('<i class="clickIco"></i>').siblings().find(".clickIco").remove()}),$(document).on("click",".slimScroll .fst",function(){$(this).next(".sec").is(":hidden")?($(".sec").slideUp(),$(this).next(".sec").slideDown()):$(this).next(".sec").slideUp()}),window.onresize=function(){perfectSize(),$(".block").is(":hidden")||(chartA.reflow(),chartB.reflow(),chartC.reflow())},$("#mapNav li").on("click",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).data("lnglat").split(",");map.setZoomAndCenter(13,a)})});
/*! nanshacity JavieChan */