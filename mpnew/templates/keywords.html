<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>分布式认证系统（二期）</title>
		<link rel="stylesheet" href="../static/css/jqueryui.css" />
		<link rel="stylesheet" href="../static/css/main.css" />
		<link rel="stylesheet" href="../static/css/2qi.css" />
		<style type="text/css">
			.sort-panel,
			.search-echart-box {
				overflow: hidden;
				width: 880px;
				margin: 0 auto;
			}
			
			.toolnav h3 {
				width: 400px;
				border-left: 3px solid #39f;
				text-indent: 0.5em;
			}
			
			.sort-list-box,
			.sort-echart-box {
				float: left;
			}
			
			.sort-echart-box {
				margin-left: 25px;
			}
			
			#searchChart,
			#sortChart {
				min-height: 300px;
				min-width: 400px;
			}
			
			.item-list {
				float: left;
				font-size: 14px;
			}
			
			.item-list li:nth-child(2n+1) {
				background-color: #f2f2f2;
			}
			
			.item-list li.item-list-title,
			.item-list-title .item-hd:hover {
				background-color: #D2F0FF;
				cursor: default;
			}
			
			.item-hd {
				padding: 5px 10px;
			}
			
			.item-hd:hover {
				background: #ffc;
				cursor: pointer;
			}
			
			.item-hd i {
				display: inline-block;
				width: 4em;
				text-indent: 0.6em;
			}
			
			.duration {
				font-size: 12px;
				line-height: 30px;
				vertical-align: middle;
			}
			
			.duration span {
				display: inline-block;
				width: 30px;
				height: 30px;
				border: 1px solid #ccc;
				border-radius: 100%;
				overflow: hidden;
				text-align: center;
				cursor: pointer;
			}
			
			.duration span.on {
				background: #08c3e5;
				color: #fff;
			}
			
			.duration span.label {
				border: 1px solid transparent;
				cursor: text;
			}
			
			.added-keywords i {
				display: inline-block;
				padding: 1px 3px;
				border: 1px solid #ccc;
				margin-right: 10px;
				cursor: pointer;
			}
			
			.added-keywords i:hover::after {
				content: ' ×';
				color: #c00;
			}
		</style>
	</head>

	<body>
		<div class="header">
			<div class="wrapper">
				<a href="/index.html" title="分布式认证系统" class="logo">分布式认证系统</a>
				<div class="admin">
					<img src="../static/images/logo_bidong.png" />
					<span class="username">liwenwen</span>
					<span class="cutofline"><i></i></span>
					<a href="/logout" class="logout">退出</a>
				</div>
				<div class="search">
					<input type="text" />
					<button><i class="searchIco"></i></button>
				</div>
			</div>
		</div>
		<div class="content">

			<div class="wrapper">
				<!--导航-->

				<div class="nav">
					<h3 class=""><a href="#"><i class="navProjectIco"></i>AP管理</a></h3>
					<h3 class=""><a href="#"><i class="navPolicyIco"></i>数据分析平台</a></h3>
					<h4 class="on"><a href="keywords.html">关键词分析</a></h4>
					<h4 class=""><a href="terminal.html">终端分析</a></h4>
					<h4 class=""><a href="website.html">网站分析</a></h4>
					<h4 class=""><a href="userhx.html">人群画像</a></h4>
					<h3 class=""><a href="#"><i class="navPolicyIco"></i>城市感知网</a></h3>
					<h4 class=""><a href="citymap.html">城市热力图</a></h4>
					<h4 class=""><a href="trend.html">区域热力趋势</a></h4>
					<h4 class=""><a href="citytrace.html">城市寻迹</a></h4>
					<h4 class=""><a href="supervise.html">AP感知预警</a></h4>
				</div>

				<!--右侧功能栏-->
				<div class="projects">
					<div class="tabbox">
						<div class="bread">
							<h2>
								<a href="#">所有项目</a>
								&gt; <span style="color:#333">数据分析平台</span>
								&gt; <span style="color:#0faee5">关键词分析</span>
							</h2>
						</div>
					</div>
					<div class="tabbox " id="">
						<div class="toolnav">
							<h3>关键词排行榜</h3>
						</div>
						<!--<div class="content-title"></div>-->
						<div class="sort-panel">
							<div class="sort-list-box">

								<ul class="item-list">
									<li class="item-list-title">
										<div class="item-hd"><i class="">排名</i><span>关键词</span></div>
									</li>
									<!--<li>
										<div class="item-hd"><i class="num-top">1</i><span>柯洁对战阿尔法狗</span></div>
									</li>-->
								</ul>
								<ul class="item-list">
									<li class="item-list-title">
										<div class="item-hd"><i class="">排名</i><span>关键词</span></div>
									</li>
									<!--<li>
										<div class="item-hd"><i class="num-normal">11</i><span>6名日本间谍被抓</span></div>
									</li>-->
								</ul>
							</div>
							<div id="sortChart" class="sort-echart-box">
								<!--饼图-->
							</div>
						</div>
					</div>
					<div class="tabbox " id="">
						<div class="toolnav">
							<h3>关键词查询</h3>
							<div class="toolbox batch">
								<input type="text" class="txt-keyToAdd" placeholder="请输入要查询的关键词" maxlength="10"><button class="btnGraySmall btn-add-keyword">+添加对比词</button>
								<button class="btnBlueSmall chaxun">查询</button>
							</div>
						</div>
						<div class="toolnav">
							<span class="added-keywords"></span> <span class="duration-box"></span>

							<div class="toolbox duration">
								<span class="label">最近</span>
								<span class="on">7天</span>
								<span>30天</span>
								<span>90天</span>
								<span>半年</span>
								<span>全部</span>
							</div>
						</div>

						<div id="searchChart" class="search-echart-box">
							<!--曲线图-->
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footer">
			<div class="wrapper">
				<p>广州中国科学院计算机网络信息中心</p>
				<p>电话：020-22992549<span></span>邮箱：gd-xub@chinaunicom.cn</p>
			</div>
		</div>

		<div class="modal fade" id="modalPn">
			<div class="modal_pn modal_body">
				<h3>新增网络配置</h3>
				<p class="notice"><em>注：</em>同一个专网只能有唯一的SSID</p>
				<ul class="vertical">
					<li>
						<label><i>*</i>私有网络：</label>
						<span class="veright">
                    <select id="pri">
                        <option value="0">否</option>
                        <option value="1">是</option>
                    </select>
                </span>
					</li>
					<li>
						<label><i>*</i>收费方式：</label>
						<span class="veright">
                    <select id="policy">
                        <option value="0">收费</option>
                        <option value="1">免费</option>
                    </select>
                </span>
					</li>
					<!--policy 第8位-->
					<li>
						<label><i>*</i>账户认证：</label>
						<span class="veright">
                    <select id="accountRZ">
                        <option value="1">启用</option>
                        <option value="0">停用</option>
                    </select>
                </span>
					</li>
					<!--policy 第9位-->
					<li>
						<label><i>*</i>微信认证：</label>
						<span class="veright">
                    <select id="wechatRZ">
                        <option value="1">启用</option>
                        <option value="0">停用</option>
                    </select>
                </span>
					</li>
					<!--policy 第10位-->
					<li>
						<label><i>*</i>手机号认证：</label>
						<span class="veright">
                    <select id="mobileRZ">
                        <option value="1">启用</option>
                        <option value="0">停用</option>
                    </select>
                </span>
					</li>
					<li>
						<label><i>*</i>SSID：</label>
						<span class="veright"><div class="verify"><input type="text" class="matchVerify shouldVerify" name="ssid" /></div></span>
					</li>
					<li>
						<label>备注：</label>
						<span class="veright"><div class="verify"><input type="text" name="note" /></div></span>
					</li>
					<li class="portalRZ">
						<label><i>*</i>Portal：</label>
						<span class="veright"><div class="verify"><input type="text" class="matchVerify shouldVerify" id="portal" /></div></span>
					</li>
					<li>
						<label>AppId：</label>
						<span class="veright"><div class="verify"><input type="text" name="appid" /></div></span>
					</li>
					<li>
						<label>ShopId：</label>
						<span class="veright"><div class="verify"><input type="text" name="shopid" /></div></span>
					</li>
					<li>
						<label>Secret：</label>
						<span class="veright"><div class="verify"><input type="text" name="secret" /></div></span>
					</li>
					<li class="durationRZ">
						<label><i>*</i>免认证(天)：</label>
						<span class="veright"><div class="verify"><input type="text" name="duration" placeholder="输入天数，例如：5" class="matchVerify shouldVerify checkInt" /></div></span>
					</li>
					<li>
						<label>会话过期时间(小时)：</label>
						<span class="veright"><div class="verify"><input type="text" name="stout" placeholder="输入小时，默认24小时" class="matchVerify checkInt" /></div></span>
					</li>
				</ul>
				<div class="btngroups"><button type="button" class="btnBlue add">确定</button></div>
				<i class="msg"></i>
				<span class="closed">X</span>
				<input type="hidden" name="id" />
				<input type="hidden" name="idx" />
			</div>
		</div>

		<div class="uptotop"><i></i>返回顶部</div>

		<script type="text/javascript" src="../static/js/lib/jquery.min.js"></script>
		<script type="text/javascript" src="../static/js/2qi.js"></script>
		<script type="text/javascript" src="../static/js/echarts.js"></script>
		<script>
			$(function() {
				ajaxQ(ajaxUrls.top20HotEn, "get", null, function(data) {
					if(data.Code.Code == 200) {
						var dList = data[" res"];
						if(typeof(dList) == "undefined" ||dList.length < 1) {
							$(".item-list:eq(0)").append("<li>暂无数据。</li>");
						} else {
							var str1="",str2="";
							for(var i=0;i<dList.length;i++){
								if(i<10){
									str1+='<li><div class="item-hd"><i class="num-top">'+dList[i].num
									str1+='</i><span>'+dList[i].name+'</span></div></li>';
								}else{
									str2+='<li><div class="item-hd"><i class="num-top">'+dList[i].num
									str2+='</i><span>'+dList[i].name+'</span></div></li>';
								}
								
							}
							
							$(".item-list:eq(0)").append(str1);
							$(".item-list:eq(1)").append(str2);
						}
					}
				})
				// 基于准备好的dom，初始化echarts实例
				var sortChart = echarts.init(document.getElementById('sortChart'));
				var searchChart = echarts.init(document.getElementById('searchChart'));
				searchChart.showLoading();

				var keywordData = {
					subtext: "",
					legendData: ['一镇', '二镇', '三镇', '四镇', '五镇', '六镇', '一街', '二街'],
					seriesData: [{
							value: 335,
							name: '一镇'
						},
						{
							value: 310,
							name: '二镇'
						},
						{
							value: 234,
							name: '三镇'
						},
						{
							value: 135,
							name: '四镇'
						},
						{
							value: 248,
							name: '五镇'
						},
						{
							value: 348,
							name: '六镇'
						},
						{
							value: 148,
							name: '一街'
						},
						{
							value: 188,
							name: '二街'
						}
					]
				}

				function getSortChartOption() {

					// 指定图表的配置项和数据
					var sortChartOption = {
						title: {
							text: '关键词搜索来源',
							subtext: keywordData.subtext,
							x: 'center'
						},
						tooltip: {
							trigger: 'item',
							formatter: "{a} <br/>{b} : {c} ({d}%)"
						},
						legend: {
							orient: 'vertical',
							left: 'left',
							data: keywordData.legendData
						},
						series: [{
							name: '搜索来源',
							type: 'pie',
							radius: '55%',
							center: ['50%', '60%'],
							data: keywordData.seriesData,
							itemStyle: {
								emphasis: {
									shadowBlur: 10,
									shadowOffsetX: 0,
									shadowColor: 'rgba(0, 0, 0, 0.5)'
								}
							}
						}]
					};

					// 使用刚指定的配置项和数据显示图表。
					sortChart.setOption(sortChartOption);
				}
				getSortChartOption();

				$(document).on("click", ".item-list li:not('.item-list-title')", function() {
					keywordData.subtext = $(this).find("span").html();
					for(var i = 0; i < keywordData.seriesData.length; i++) {
						keywordData.seriesData[i].value = 100 + parseInt(Math.random() * 300);
					}
					getSortChartOption();
					console.log(keywordData.subtext)
				})

				var xAxisDataArr = [
					[], //7
					[], //30
					[], //90
					[], //180
					[], //360
				];

				//7天
				for(var i = 7; i > 0; i--) {
					var d = new Date();
					d.setDate(d.getDate() - i);
					xAxisDataArr[0].push((d.getMonth() + 1) + "月" + d.getDate());
				}
				//30天
				for(var i = 30; i > 0; i -= 2) {
					var d = new Date();
					d.setDate(d.getDate() - i);
					xAxisDataArr[1].push((d.getMonth() + 1) + "月" + d.getDate());
				}
				//90天
				for(var i = 90; i > 0; i -= 3) {
					var d = new Date();
					d.setDate(d.getDate() - i);
					xAxisDataArr[2].push((d.getMonth() + 1) + "月" + d.getDate());
				}
				//180天
				for(var i = 180; i > 0; i -= 4) {
					var d = new Date();
					d.setDate(d.getDate() - i);
					xAxisDataArr[3].push((d.getMonth() + 1) + "月" + d.getDate());
				}
				//360天
				for(var i = 360; i > 0; i -= 5) {
					var d = new Date();
					d.setDate(d.getDate() - i);
					xAxisDataArr[4].push(d.getFullYear() + "年" + (d.getMonth() + 1) + "月" + d.getDate());
				}
				//				for(var i=0;i<xAxisDataArr.length;i++){
				//					console.log(xAxisDataArr[i].length)
				//				}
				var searchData = {
					//					legendData: [],
					xAxisData: xAxisDataArr[0],
					seriesData: []
				}

				var durationNum = 0,
					durArr = [7, 30, 90, 180, 360];
				var setDurationStr = function() {
					//时间区间
					var d = new Date();
					var durationStr = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
					d.setDate(d.getDate() - durArr[durationNum]);
					durationStr = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate() + " 至 " + durationStr;
					$(".duration-box").html(durationStr);
				}
				setDurationStr();
				$(document).on("click", ".duration span", function() {
					if($(this).hasClass("label") || $(this).hasClass("on")) {
						return;
					}
					durationNum = $(this).index() - 1;
					setDurationStr();
					searchData.xAxisData = xAxisDataArr[durationNum];
					if(addedKeyWords.length > 0) {
						searchChart.showLoading();
						getSearchChartOption();
					}
					$(".duration span").removeClass("on");
					$(this).addClass("on");
				})

				var addedKeyWords = [];
				$(document).on("click", ".btn-add-keyword", function() {
					var keytoadd = $(".txt-keyToAdd").val();
					if(keytoadd == "") {
						return
					}
					if(addedKeyWords.length >= 3) {
						alert("最多查询三个对比词");
						return false;
					}
					if(addedKeyWords.indexOf(keytoadd) > -1) {
						alert("对比词已存在");
						return false;
					}
					$(".added-keywords").append("<i>" + keytoadd + "</i>");
					addedKeyWords.push(keytoadd);
				})

				//				$(document).on("mouseover", ".added-keywords i", function() {
				//					$(this).addClass("over");
				//				})
				$(document).on("click", ".added-keywords i", function() {
					var idx = $(this).index();
					$(this).remove();
					addedKeyWords.splice(idx, 1);
					searchChart.showLoading();
					getSearchChartOption();
				})

				var curWordsNum = 0;
				$(document).on("click", ".chaxun", function() {
					if(addedKeyWords.length < 1) {
						alert("请添加关键字");
						return false;
					}

					searchChart.showLoading();
					getSearchChartOption();
				})

				function getSearchChartOption() {
					var allSeriesData = [];
					for(var i = 0; i < 3; i++) {
						if(i + 1 > addedKeyWords.length) {
							//填坑：如果没有这个空数据，echart在重新加载数据渲染图形时，会遗留原有数据
							var seriesData = {
								name: '',
								type: 'line',
								smooth: true,
								areaStyle: {
									normal: {}
								},
								data: [] //空
							}
						} else {
							var seriesData = {
								name: addedKeyWords[i],
								type: 'line',
								smooth: true,
								areaStyle: {
									normal: {}
								},
								data: []
							}
							var nRandom = 2 * parseInt(Math.random() * 200)
							for(var j = 0; j < searchData.xAxisData.length; j++) {
								seriesData.data.push(nRandom + parseInt(Math.random() * 100));
							}
						}
						allSeriesData.push(seriesData);
					}
					//					curWordsNum=addedKeyWords.length;
					//					searchChart.setOption({});

					var searchChartOption = {
						title: {
							text: ''
						},
						tooltip: {
							trigger: 'axis',
							axisPointer: {
								type: 'cross',
								label: {
									backgroundColor: '#6a7985'
								}
							}
						},
						//						legend: {
						//							data: searchData.legendData
						//						},
						toolbox: {
							//							feature: {
							//								saveAsImage: {}
							//							}
						},
						dataZoom: [{ // 这个dataZoom组件，默认控制x轴。
							type: 'slider', // 这个 dataZoom 组件是 slider 型 dataZoom 组件
							start: 0, // 左边在 10% 的位置。
							end: 100 // 右边在 60% 的位置。
						}],
						grid: {
							left: '3%',
							right: '4%',
							bottom: '3%',
							containLabel: true
						},
						xAxis: [{
							type: 'category',
							boundaryGap: false,
							data: searchData.xAxisData
						}],
						yAxis: [{
							type: 'value'
						}],
						series: allSeriesData
					};
					//console.log(searchChartOption.series)

					//					searchChart.setOption(initSearchChartOption);
					//					setTimeout(function(){
					searchChart.hideLoading();
					searchChart.setOption(searchChartOption);
					//					},200)

				}
				getSearchChartOption();
				$(".label").click(function() {
					console.log("sad")
					searchChart.setOption(initSearchChartOption);
				})

			})
		</script>
	</body>

</html>