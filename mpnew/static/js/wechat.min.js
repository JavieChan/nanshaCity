function Request(){this.protocol="http",this.host="10.20.1.40",this.port="9092",this.version="v0"}function wechatRequest(){Request.call(this)}Request.prototype._send=function(a,b,c,d,e){var f=b;$.ajax({method:a,url:f,dataType:"json",data:c}).done(function(a){console.log(a),200==parseInt(a.code)?$.isFunction(d)&&d(a):$.isFunction(e)?e(a):alert(a.reason)}).fail(function(a){console.log(a),alert("[请求失败]系统繁忙")})},Request.prototype._post=function(a,b,c,d){this._send("post",a,b,c,d)},Request.prototype._get=function(a,b,c,d){this._send("get",a,b,c,d)},Request.prototype._put=function(a,b,c,d){this._send("put",a,b,c,d)},Request.prototype._delete=function(a,b,c,d){this._send("delete",a,b,c,d)},wechatRequest.prototype=new Request,wechatRequest.prototype.getWxpromote=function(a){this._get("/wxpromote","",function(b){a(b)})},wechatRequest.prototype.pustWxpromote=function(a,b,c,d,e,f){var g={wechat_id:a,nickname:b,account:c,password:d,image_uri:e};this._post("/wxpromote",JSON.stringify(g),function(a){f(a)})},wechatRequest.prototype.putWxpromote=function(a,b,c,d,e,f,g){var h={id:a,wechat_id:b,nickname:c,account:d,password:e,image_uri:f};this._put("/wxpromote",JSON.stringify(h),function(a){g(a)})},wechatRequest.prototype.deleteWxpromote=function(a,b){var c={wechat_id:a};this._delete("/wxpromote",JSON.stringify(c),function(a){b(a)})},wechatRequest.prototype.deleteWxpromotes=function(a,b){var c={wechat_id_list:a};this._post("/wxpromote/bulk-delete",JSON.stringify(c),function(a){b(a)})},wechatRequest.prototype.getUsingWxpromote=function(a){this._get("/wxpromote/promoting","",function(b){a(b)})},wechatRequest.prototype.usingWxpromote=function(a,b){var c={wechat_id:a};this._post("/wxpromote/promoting",JSON.stringify(c),function(a){b(a)})},$(function(){$(document).on("click","#modalWechat, #modalWechat .closed",function(){vm.nowIndex=-1,$("#modalWechat").modal("closed")}),$(document).on("click","#modalChangeWechat, #modalChangeWechat .closed",function(){$("#modalChangeWechat").modal("closed")})});var wcr=new wechatRequest,vm=new Vue({el:"#promote",data:{haspromote:!1,using:{wechatId:"",nickname:"",account:"",password:"",qrcode:""},promoteList:[],nowIndex:-1,editStatus:!1,checkGroup:[]},mounted:function(){var a=this;a.getUsingPromote(),a.getPromotes()},computed:{editArr:function(){if(this.nowIndex>=0){this.editStatus=!0;var a=this.promoteList[this.nowIndex]}else{this.editStatus=!1;var a={id:"",wechat_id:"",nickname:"",account:"",password:"",image_uri:""}}return a.image_uri?$(".showImg").show():$(".showImg").hide(),{id:a.id,wechatId:a.wechat_id,nickname:a.nickname,account:a.account,password:a.password,imageUrl:a.image_uri}},checkAll:function(){return this.checkGroup.length>0}},methods:{checkAllPromote:function(){var a=this;a.checkAll?a.checkGroup=[]:(a.checkGroup=[],a.promoteList.forEach(function(b){a.checkGroup.push(b.wechat_id)}))},getUsingPromote:function(){var a=this;wcr.getUsingWxpromote(function(b){if(!$.isEmptyObject(b.wechat)){var c=b.wechat;a.haspromote=!0,a.using={wechatId:c.wechat_id,nickname:c.nickname,account:c.account,password:c.password,qrcode:c.image_uri}}})},getPromotes:function(){var a=this;wcr.getWxpromote(function(b){a.promoteList=b.wechat_list})},usingWxpromote:function(a){var b=this;confirm("确定要应用该微信号？")&&wcr.usingWxpromote(b.promoteList[a].wechat_id,function(a){window.location.reload()})},openPromoteModal:function(){$("#modalChangeWechat").modal("open")},openModal:function(a){this.nowIndex=a,$("#modalWechat").modal("open")},addPromote:function(){var a=this;if(0==checkInput($("#modalWechat .veright"))){var b=$("input[name=wechatQrcode]").val();a.editArr.imageUrl=b,wcr.pustWxpromote(a.editArr.wechatId,a.editArr.nickname,a.editArr.account,a.editArr.password,a.editArr.imageUrl,function(b){a.promoteList.unshift(b.wechat),$("#modalWechat").modal("closed"),a.nowIndex=-2})}},savePromote:function(){var a=this;if(0==checkInput($("#modalWechat .veright"))){var b=$("input[name=wechatQrcode]").val();a.editArr.imageUrl=b,wcr.putWxpromote(a.editArr.id,a.editArr.wechatId,a.editArr.nickname,a.editArr.account,a.editArr.password,a.editArr.imageUrl,function(b){a.promoteList.splice(a.nowIndex,1,b.wechat),$("#modalWechat").modal("closed"),a.nowIndex=-1})}},deleteUploadImg:function(){this.editArr.imageUrl=""},deletePromote:function(a){var b=this,c=b.promoteList[a];return 1==c.status?(alert("该微信号正在推广中，无法删除该微信号，请先取消应用该微信号后再尝试删除！"),!1):void(confirm("确定要删除该微信号吗？")&&wcr.deleteWxpromote(c.wechat_id,function(d){b.promoteList.splice(a,1);var e=$.inArray(c.wechat_id,b.checkGroup);e>=0&&b.checkGroup.splice(e,1)}))},deletePromotes:function(){var a=this;return $.inArray(a.using.wechatId,a.checkGroup)>=0?(alert("尝试删除的微信号正在被使用，无法删除！"),!1):void(confirm("确定要删除这些微信号吗？")&&wcr.deleteWxpromotes(a.checkGroup.join(","),function(a){window.location.reload()}))}}});