function Request(){this.protocol="http",this.host="10.20.1.14",this.port="9092",this.version="v0"}function wechatRequest(){Request.call(this)}Vue.component("paginator",{template:'<div class="paginator">            <button type="button" class="btnWhiteSmall" v-on:click="pagePrev">上一页</button>            <span>{{ page }}</span> / <span>{{ total }}</span>            <button type="button" class="btnWhiteSmall" v-on:click="pageNext">下一页</button>            <input type="text"  v-model="jump" style="width:60px" placeholder="1" />            <button type="button" class="btnWhiteSmall" v-on:click="pageJump" style="width:60px">跳转</button>        </div>',props:["currentPage","totalPage","jumpPage"],data:function(){return{page:this.currentPage,total:this.totalPage,jump:this.jumpPage}},watch:{currentPage:function(a,b){this.page=a},totalPage:function(a,b){this.total=a},jumpPage:function(a,b){this.jump=a}},methods:{pagePrev:function(){return this.page-=1,this.page<1?(this.page=1,!1):void this.$emit("page-change",this.page)},pageNext:function(){return this.page+=1,this.page>this.total?(this.page=this.total,!1):void this.$emit("page-change",this.page)},pageJump:function(){this.jump>=1&&this.jump<=this.total&&(this.page=this.jump,this.$emit("page-change",this.page))}}}),Request.prototype._send=function(a,b,c,d,e){var f=b;$.ajax({method:a,url:f,dataType:"json",data:c}).done(function(a){console.log(a),200==parseInt(a.code)?$.isFunction(d)&&d(a):$.isFunction(e)?e(a):alert(a.reason)}).fail(function(a){console.log(a),alert("[请求失败]系统繁忙")})},Request.prototype._post=function(a,b,c,d){this._send("post",a,b,c,d)},Request.prototype._get=function(a,b,c,d){this._send("get",a,b,c,d)},Request.prototype._put=function(a,b,c,d){this._send("put",a,b,c,d)},Request.prototype._delete=function(a,b,c,d){this._send("delete",a,b,c,d)},wechatRequest.prototype=new Request,wechatRequest.prototype.getWxpromote=function(a,b){var c={page:a};this._get("/wxpromote",c,function(a){b(a)})},wechatRequest.prototype.getAllWxpromote=function(a){this._get("/wxpromote","",function(b){a(b)})},wechatRequest.prototype.pustWxpromote=function(a,b,c,d,e,f){var g={wechat_id:a,nickname:b,account:c,password:d,image_uri:e};this._post("/wxpromote",JSON.stringify(g),function(a){f(a)})},wechatRequest.prototype.putWxpromote=function(a,b,c,d,e,f,g){var h={id:a,wechat_id:b,nickname:c,account:d,password:e,image_uri:f};this._put("/wxpromote",JSON.stringify(h),function(a){g(a)})},wechatRequest.prototype.deleteWxpromote=function(a,b){var c={id:a};this._delete("/wxpromote",JSON.stringify(c),function(a){b(a)})},wechatRequest.prototype.deleteWxpromotes=function(a,b){var c={id_list:a};this._post("/wxpromote/bulk-delete",JSON.stringify(c),function(a){b(a)})},wechatRequest.prototype.getUsingWxpromote=function(a){this._get("/wxpromote/promoting","",function(b){a(b)})},wechatRequest.prototype.usingWxpromote=function(a,b){var c={id:a};this._post("/wxpromote/promoting",JSON.stringify(c),function(a){b(a)})},$(function(){$(document).on("click","#modalWechat, #modalWechat .closed",function(){vm.nowIndex=-1,$("#modalWechat .file input").val(""),$("#modalWechat .showImg img").attr("src",""),$("#modalWechat .showImg").hide(),$("#modalWechat").modal("closed")}),$(document).on("click","#modalChangeWechat, #modalChangeWechat .closed",function(){$("#modalChangeWechat").modal("closed")})});var wcr=new wechatRequest,vm=new Vue({el:"#promote",data:{haspromote:!1,using:{id:"",wechatId:"",nickname:"",account:"",password:"",qrcode:""},currentPage:1,totalPage:1,jumpPage:"",promoteList:[],allPromotes:[],nowIndex:-1,editStatus:!1,checkGroup:[]},mounted:function(){var a=this;a.getUsingPromote(),a.pageChange(1),a.getAllpromotes()},computed:{editArr:function(){if(this.nowIndex>=0){this.editStatus=!0;var a=this.promoteList[this.nowIndex]}else{this.editStatus=!1;var a={id:"",wechat_id:"",nickname:"",account:"",password:"",image_uri:""}}return a.image_uri?$(".showImg").show():$(".showImg").hide(),{id:a.id,wechatId:a.wechat_id,nickname:a.nickname,account:a.account,password:a.password,imageUrl:a.image_uri}},checkAll:function(){return this.checkGroup.length>0}},methods:{checkAllPromote:function(){var a=this;a.checkAll?a.checkGroup=[]:(a.checkGroup=[],a.promoteList.forEach(function(b){a.checkGroup.push(b.id)}))},getUsingPromote:function(){var a=this;wcr.getUsingWxpromote(function(b){if(!$.isEmptyObject(b.wechat)){var c=b.wechat;a.haspromote=!0,a.using={id:c.id,wechatId:c.wechat_id,nickname:c.nickname,account:c.account,password:c.password,qrcode:c.image_uri}}})},getAllpromotes:function(){var a=this;wcr.getAllWxpromote(function(b){a.allPromotes=b.wechat_list})},usingWxpromote:function(a){var b=this;confirm("确定要应用该微信号？")&&wcr.usingWxpromote(b.promoteList[a].id,function(a){window.location.reload()})},usingAllWxpromote:function(a){var b=this;confirm("确定要应用该微信号？")&&wcr.usingWxpromote(b.allPromotes[a].id,function(a){window.location.reload()})},openPromoteModal:function(){$("#modalChangeWechat").modal("open")},openModal:function(a){this.nowIndex=a,$("#modalWechat").modal("open")},addPromote:function(){var a=this;if(0==checkInput($("#modalWechat .veright"))){var b=$("input[name=wechatQrcode]").val();a.editArr.imageUrl=b,wcr.pustWxpromote(a.editArr.wechatId,a.editArr.nickname,a.editArr.account,a.editArr.password,a.editArr.imageUrl,function(b){a.promoteList.unshift(b.wechat),a.allPromotes.unshift(b.wechat),$("#modalWechat").modal("closed"),a.nowIndex=-2})}},savePromote:function(){var a=this;if(0==checkInput($("#modalWechat .veright"))){var b=$("input[name=wechatQrcode]").val();a.editArr.imageUrl=b,wcr.putWxpromote(a.editArr.id,a.editArr.wechatId,a.editArr.nickname,a.editArr.account,a.editArr.password,a.editArr.imageUrl,function(b){var c=b.wechat;a.using.id==c.id&&(a.using={wechatId:c.wechat_id,nickname:c.nickname,account:c.account,password:c.password,qrcode:c.image_uri}),a.promoteList.splice(a.nowIndex,1,c);var d="";a.allPromotes.forEach(function(a,b){if(c.id==a.id)return d=b,!1}),a.allPromotes.splice(d,1,c),$("#modalWechat").modal("closed"),a.nowIndex=-1})}},deleteUploadImg:function(){this.editArr.imageUrl=""},deletePromote:function(a){var b=this,c=b.promoteList[a];return 1==c.status?(alert("该微信号正在推广中，无法删除该微信号，请先取消应用该微信号后再尝试删除！"),!1):void(confirm("确定要删除该微信号吗？")&&wcr.deleteWxpromote(c.id,function(d){b.promoteList.splice(a,1);var e=$.inArray(c.id,b.checkGroup);e>=0&&b.checkGroup.splice(e,1)}))},deletePromotes:function(){var a=this;return 0==a.checkGroup.length?(alert("请选择要删除的微信号！"),!1):$.inArray(a.using.id,a.checkGroup)>=0?(alert("尝试删除的微信号正在被使用，无法删除！"),!1):void(confirm("确定要删除这些微信号吗？")&&wcr.deleteWxpromotes(a.checkGroup.join(","),function(a){window.location.reload()}))},pageChange:function(a){var b=this;wcr.getWxpromote(a,function(a){b.checkGroup=[],b.currentPage=a.current_page,b.totalPage=a.total_pages,b.promoteList=a.wechat_list})}}});