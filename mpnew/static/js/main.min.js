/*! nanshacity author:JavieChan create:2017-05-10 */
function acAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"acs/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function billAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"paypolicy/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function billWebTypeFunc(a,b,c,d){$.ajax({method:a,url:proUrl+"webtype/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function resAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"resources/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function fiberAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"fibers/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function planAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"sens/map/ap/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function sensGroupAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"sens/list/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(err)})}function sensMemberAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"sens/member/list/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function userOnlineAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"user/online/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function userGuestAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"user/guest/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function userAccountAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"user/account/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function userPayAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"user/pay/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function userPnAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"user/pn/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function userInnerAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"user/inner/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function planMemberAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"sens/map/member/list/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function planEnableAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"sens/ap/enable/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function appPushAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"app/push/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function userAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"pn/users/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function accountAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"admin/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function roleAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"role/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function pnAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"pns/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function portalAjax(a,b,c,d,e){$.ajax({method:a,url:wnlUrl+"/wnl/portal/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function sensAjax(a,b,c,d,e){$.ajax({method:a,url:proUrl+"sens/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function planQvAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"sens/map/group/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function planImgAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"sens/map/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function planAPAjax(a,b,c){$.ajax({method:"get",url:proUrl+"sens/map/ap/list/",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c(a)})}function apbindAjax(a,b,c){$.ajax({method:"put",url:proUrl+"aps/batch/",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c(a)})}function acbindAjax(a,b,c){$.ajax({method:"put",url:proUrl+"gw",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c(a)})}function billFunc(a,b,c){$.ajax({method:"get",url:proUrl+"payrecord/stat",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c(a)})}function payrecordFunc(a,b,c,d,e){$.ajax({method:a,url:proUrl+"payrecord2/"+b,data:c,dataType:"json"}).done(function(a){d(a)}).fail(function(a){console.log(a),"function"==typeof e&&e(a)})}function onlineRecordFunc(a,b,c,d){$.ajax({method:a,url:proUrl+"user/connect/record/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function urlRecordFunc(a,b,c,d){$.ajax({method:a,url:proUrl+"webhistory/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function payFunc(a,b,c){$.ajax({method:"put",url:proUrl+"payaccount/",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c(a)})}function apAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"aps/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function apgroupAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"apgroup/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function apgrouplistAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"apgroup/list",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function sendAccountAjax(a,b,c,d){$.ajax({method:"post",url:window.location.protocol+"//wnl.bidongwifi.com:9899/mobile/"+a+"/notify",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d(a)})}function ajaxImg(a,b,c){c.parent().find(".loading").show(),$.ajaxFileUpload({url:proUrl+"image",secureuri:!1,fileElementId:a,dataType:"json",success:function(a){var c=$("#"+b);c.attr("src",a.imgurl),c.parent().show(),c.parent().prev().find(".loading").hide(),c.parent().prev().find("input[type=hidden]").removeClass("error").val(a.imgurl),c.parent().prev().find(".errormsg").remove()},error:function(a,b,c){console.log(c)}})}function ajaxImgSec(a,b){b.parent().find(".loading, .delsgt").show(),$.ajaxFileUpload({url:proUrl+"image",secureuri:!1,fileElementId:a,dataType:"json",success:function(b){var c=$("#"+a);c.siblings("em").text(b.imgurl),c.siblings("input[type=hidden]").val(b.imgurl).removeClass("error"),c.siblings(".loading").hide(),c.siblings(".errormsg").remove()},error:function(a,b,c){console.log(c)}})}function ajaxImgThd(a){var b=$("#"+a);b.parent().find(".loading").show(),$.ajaxFileUpload({url:proUrl+"image",secureuri:!1,fileElementId:a,dataType:"json",success:function(b){var c=$("#"+a),d=$(".adsnav li.on").index();0==d?c.parent().parent().parent().next("div").find(".bg").attr("src",b.imgurl):1==d&&c.parent().parent().parent().next("div").find(".ptBody").css("background-image",'url("'+b.imgurl+'")'),c.siblings("input[type=hidden]").val(window.location.protocol+"//"+window.location.hostname+b.imgurl),c.siblings(".loading").hide()},error:function(a,b,c){console.log(c)}})}function wnlajaxImgThd(a){var b=$("#"+a);b.parent().find(".loading").show(),$.ajaxFileUpload({url:wnlUrl+"/wnl/fs/",secureuri:!1,fileElementId:a,success:function(b,c){console.log(b);var d=$(b).find("body").text(),e=$.parseJSON(d),f=$("#"+a),g=$(".adsnav li.on").index();0==g?$(".pt_h5 .ptD img.hidbg").attr("src",e.url).load(function(){console.log("load h5"),$(".pt_h5 .ptD img.bg").attr("src",e.url)}):1==g&&$(".pt_pc .ptD img.hidbg").attr("src",e.url).load(function(){console.log("load pc"),$(".pt_pc .ptD .ptBody").attr("style","background-image:url("+e.url+")")}),f.siblings("input[type=hidden]").val(e.url),f.siblings(".loading").hide()},error:function(a,b,c){console.log(c)}})}function uploadfile(a){var b=$("#"+a);b.parent().find(".loading").show(),$.ajaxFileUpload({url:"/file",secureuri:!1,fileElementId:a,dataType:"json",success:function(b,c){console.log(b);var d=$("#"+a);console.log(d),d.parent().find(".loading").hide(),d.parent().find("i.errormsg").remove(),d.parent().find("em").text(b.url),d.parent().find("input[type=hidden]").val(b.url)},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}function mutiUpload(a,b){var c=$("#"+a);c.uploadify({swf:"/static/js/lib/uploadify/uploadify.swf",uploader:"/fs/",width:100,height:40,buttonClass:"btnGreen",buttonText:"选择图片",fileTypeDesc:"Image Files",fileTypeExts:"*.jpg; *.png",queueSizeLimit:b,onUploadSuccess:function(d,e,f){var g=$.parseJSON(e);c=$("#"+a);var h=function(a,b){a.length>b&&a.splice(0,a.length-b);for(var c="",d="",e=0;e<a.length;e++)c+='<img src="'+a[e]+'" />',d=0==e?a[e]:d+","+a[e];return[c,d]},i=c.parent().find(".imgShow").data("value"),j=""==i?[]:i.split(",");j.push(g.url),c.parent().find(".imgShow").html(h(j,b)[0]),c.parent().find(".imgShow").data("value",h(j,b)[1])},onUploadError:function(a,b,c,d){console.log("The file "+a.name+" could not be uploaded: "+d)}})}function getParam(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2].replace(/\+/g,"+")):null}function getStat(a,b){var c=[],d=[],e=[],f=[];return $.each(a,function(a,g){0==b?c.push(a.substr(-2,2)):c.push(a),d.push(g.conns),e.push(g.onlines),f.push(g.offlines)}),{a:c,b:d,c:e,d:f}}function dateSub(a){return a.substr(-2,2)}function checkInput(a){var b=a.find("input.shouldVerify");return b.each(function(a,b){$(b).hasClass("checkFile")?($(b).siblings("em").length>0&&""==$(b).siblings("em").text()||""==$(b).val())&&inputError("*上传文件/图片",b):""==$(b).val()||null==$(b).val()?$(b).hasClass("error")||inputError("*必填",b):$(b).hasClass("error")&&inputError("",b)}),a.find("input.shouldVerify.error").length}function checkIpu(a){var b=a.find("input"),c=0;return b.each(function(a,b){""!=$(b).val()&&null!=$(b).val()||c++}),c}function inputError(a,b){if(""==a)$(b).parent().find("i.errormsg").remove(),$(b).removeClass("error");else{$(b).parent().find("i.errormsg").remove();var c='<i class="errormsg">'+a+"</i>";$(b).parent().append(c),$(b).addClass("error")}}function lastStr(a){var b=a.split(",");return b[b.length-1]}function changeSelectFunc(id,val){var func=eval("change"+id);return func(val)}function changevendor(a){var b=$.trim(a);if("hanming"==b||"Hanming"==b)var c='<i class="vendor hanming"></i>';else if("ruijie"==b||"Ruijie"==b)var c='<i class="vendor ruijie"></i>';else if("h3c"==b||"H3C"==b)var c='<i class="vendor h3c"></i>';else if("huawei"==b||"Huawei"==b)var c='<i class="vendor huawei"></i>';else if("xinrui"==b||"Xinrui"==b)var c='<i class="vendor xinrui"></i>';else if("shenxinfu"==b||"Shenxinfu"==b)var c='<i class="vendor shenxinfu"></i>';else var c=b;return c}function changepri(a){return 0==a?"否":"是"}function addLoad(a){$(".wrapLoad").is(":hidden")&&($(".wrapLoad p").html(a),$(".wrapLoad").show())}function removeLoad(){$(".wrapLoad").hide()}function dateFormate(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1;c=c<10?"0"+c:c;var d=a.getDate();d=d<10?"0"+d:d;var e=b+"-"+c+"-"+d;return e}function GetDateStr(a){var b=new Date;b.setDate(b.getDate()+a);var c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate();return d<9&&(d="0"+d),c+"-"+d+"-"+e}function resizeZW(){var a=$("#zw").height();$("#zw").css("margin-top",-Math.ceil(a/2)+"px")}window.proUrl="/",window.nsmUrl="http://nsm.cniotroot.cn",window.cmsUrl="http://cms.cniotroot.cn",window.wnlUrl="http://183.63.152.237:9898",window.imgUrl="/message/image";var mpHostname=window.location.hostname;"172.31.1.200"!=mpHostname&&"112.94.162.4"!=mpHostname||(wnlUrl="",cmsUrl="",imgUrl="/wnl/fs/"),$(function(){$("body").append('<div class="wrapLoad"><img src="../static/images/wrapload.gif" /><p>正在加载中...</p></div>'),addLoad("正在加载中");var $trThis;$(".amount").amount(),$(window).scroll(function(){var a=$(this).scrollTop();a>200?$(".uptotop").fadeIn():$(".uptotop").fadeOut()}),$(document).on("click",".uptotop",function(){$("body,html").animate({scrollTop:0},700)}),$(document).on("click",".ns_subtab .more",function(){var a=$(this).parent().siblings(".areabox"),b=a.find(".magnet").length;a.hasClass("showall")?(a.css("height","53px").removeClass("showall"),$(this).html('更多<i class="aDwn"></i>')):(a.css("height",53*(Math.floor(b/4)+1)+"px").addClass("showall"),$(this).html('收起<i class="aUp"></i>'))}),$(document).on("click",".ns_subtab .search button",function(){var a=$.trim($(this).siblings("input").val()),b=0;return $(".magnet").each(function(c,d){var e=$(d).find(".name").text();""==a?($(d).show(),b++):e.indexOf(a)>=0?($(d).show(),b++):$(d).hide()}),0==b?($(".magnet").show(),$(".ns_subtab .more").show(),alert("没有匹配项！"),!1):void(b>4?$(".ns_subtab .more").show():$(".ns_subtab .more").hide())});var forbinACFlag=!0;$(document).on("click",".forbinAC",function(){forbinACFlag?($(this).text("启用"),$(".magnet").each(function(a,b){$(b).append('<i title="删除"></i>')}),forbinACFlag=!1):($(this).text("禁用"),$(".magnet").each(function(a,b){$(b).find("i").remove()}),forbinACFlag=!0)}),$(document).on("click",".magnet i",function(a){var b=$(this);return confirm("确定要删除该项目吗？")&&resAjax("delete",{location:b.siblings("input").val()},function(a){200==a.code?b.parent().fadeOut(function(){$(this).remove()}):(console.log(a),alert("删除失败！"))}),!1}),$(document).on("mouseenter",".pwdtip",function(){var a=$(this).attr("data-tip"),b=$(this).offset().top,c=$(this).offset().left,d='<span class="tip">'+a+"</span>";$("body").append(d);var e=$(".tip").outerWidth(),f=$(".tip").outerHeight();$(".tip").css({left:c-e/2+"px",top:b-f-5+"px"})}),$(document).on("mouseleave",".pwdtip",function(){$(".tip").remove()}),$(document).on("click","#AP001",function(){$(this).next("div").toggle()}),$(document).on("click",".preventUrl",function(a){a.preventDefault(),alert("只有在本地服务器可以使用本功能！")}),1==$(".tabbox").length?$(".tabbox").css("min-height","833px"):$(".tabbox:last-child").css("padding-bottom","90px"),$(".table_td:even").css("background","#eff8f9"),$(".tabnav li:last").hide(),$(document).on("click",".checklist dd",function(){$(this).find("i").toggleClass("on")}),$(document).on("click",".uncheck_s",function(a){$(this).toggleClass("on"),a.stopPropagation()}),$(document).on("click",".checktabs dd",function(){$(this).addClass("on").siblings().removeClass("on")}),$(document).on("focus",".matchVerify",function(){inputError("",this)}),$(document).on("blur",".matchVerify",function(){var a=$.trim($(this).val());$(this).hasClass("checkPhone")&&!/^1[0-9]{10}$/.test(a)?inputError("*输入有效的手机号",this):$(this).hasClass("checkFloat")?/^[0-9]+([.][0-9]+){0,1}$/.test(a)?$(this).val(a.match(/^\d+(\.\d{1,2})?/)[0]):inputError("*输入有效值",this):$(this).hasClass("checkInt")?/^[0-9]+$/.test(a)?$(this).val(a.match(/[1-9][0-9]*/)[0]):inputError("*输入整数",this):$(this).hasClass("checkEng")?/^[\u4e00-\u9fa5]*$/.test(a)&&inputError("*不能是中文",this):$(this).hasClass("checkMac")&&(/^[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}$/.test(a)||inputError("*格式不正确",this))}),$(document).on("click",".errormsg",function(){$(this).parent().find("input[type=text]").trigger("focus")}),$(document).on("click",".adsnav li",function(){var a=$(this).position().left;$(".adskpi i").css("left",a+35+"px")}),$(document).on("click","#sensMemTable .st, #sensTable .st",function(a){a.stopPropagation();var b=$(this).parents(".ouTable").next(".siTable").find("div"),c=$(this).parents(".ouTable").next(".siTable").find("i");b.is(":hidden")?($(this).addClass("on"),c.show(),b.slideDown()):($(this).removeClass("on"),b.slideUp("normal",function(){c.hide()}))}),$(document).on("click","#sens table tbody tr",function(a){a.stopPropagation();var b=$("#location").val(),c=$(this).data("group-id");window.location.href="/projectsensgroup.html?location="+b+"&group_id="+c}),$(document).on("click","#sensRoom .ouTable",function(a){a.stopPropagation();var b={location:$("#location").val(),sta_mac:$(this).data("mac"),start:$("#dateStart").val(),end:$("#dateEnd").val(),group_id:$("#groupId").val()};window.location.href="/projectsensmember.html?"+$.param(b)}),$(document).on("click","#sensTable .delete",function(a){a.stopPropagation();var b=$(this);if(confirm("确定要删除该感知组吗？")){var c=$(this).parents(".ouTable").data("group-id");console.log(c),sensAjax("delete",c,"",function(a){200==a.code?b.parents("tbody").fadeOut(function(){$(this).remove()}):alert("删除失败")})}}),$(document).on("click","#sens .addbtn",function(){$("#modalSens").modal("open")}),$(document).on("click","#modalSens, #modalSens .closed",function(){$(".checktabs dd:eq(2)").addClass("on").siblings().removeClass("on"),$("#modalSens").modal("closed")}),$(document).on("click","#modalSens .add",function(){var a=[],b=$("#location").val();if($(".checklist dd i").each(function(b,c){$(c).hasClass("on")&&a.push($(c).next("em").attr("data-id"))}),checkInput($(this).parent().parent())>0)return!1;if(0==a.length)$(".msg").text("至少选择一个AP");else{$(".msg").text("");var c={page_size:-1,location:b,group:$("input[name=group]").val(),aps:a.join(","),scale:$("input[name=scale]").val(),warning:$("input[name=warning]").val()};sensAjax("post","",c,function(a){200==a.code&&(window.location.href="/projectsens.html?location="+b)})}}),$(document).on("click","#sensRoom .editbtn",function(){$("#modalAP").modal("open")}),$(document).on("click","#modalAP, #modalAP .closed",function(){$("#modalAP").modal("closed")}),$(document).on("click","#modalAP .add",function(){var a=[],b=[],c=$("#location").val(),d=$("#groupId").val();$(".checklist dd i").each(function(c,d){if($(d).hasClass("on")){var e={};a.push($(d).next("em").attr("data-id")),e.id=$(d).next("em").attr("data-id"),e.name=$(d).next("em").text(),b.push(e)}}),0==a.length?$(".msg").text("至少选择一个AP"):($(".msg").text(""),$.ajax({method:"post",url:proUrl+"sens/aps?page_size=-1",dataType:"json",data:{location:c,group_id:d,aps:a.join(",")},success:function(a){if(200==a.code){$("#modalAP").modal("closed"),$(".sensContent .sensap").remove();for(var c="",d=0,e=b.length;d<e;d++){var f='<div class="sensap"><div><label>AP名称：</label><span>'+b[d].name+'</span></div><em data-ap-id="'+b[d].id+'">删除</em></div>';c+=f}$(".sensContent").append(c)}}}))}),$(document).on("click",".sensap em",function(){var a=$("#location").val(),b=$("#groupId").val(),c=$(this).attr("data-ap-id"),d=$(this);confirm("确定要删除吗？")&&$.ajax({method:"delete",url:proUrl+"sens/aps",dataType:"json",data:{location:a,group_id:b,ap_id:c},success:function(a){200==a.code&&d.parent().remove()}})}),$(document).on("click","#sensExport",function(){var a={location:$("#location").val(),group_id:$("#groupId").val(),start:$("#dateStart").val(),end:$("#dateEnd").val(),keyword:$("#search input").val()};confirm("是否导出所有mac?")?a.mac=1:a.mac=0,$("#sensExportHref").attr("href","/sensmembers.xls?"+$.param(a)),$("#sensExportHref span").click()}),$(document).on("click","#connectRecordExport",function(){var a={user:$("#userHid").val(),mobile:$("#mobileHid").val(),start:$("#dateStart").val(),end:$("#dateEnd").val(),mac:$("#macHid").val()};$(this).attr("href","/connect_record.xls?"+$.param(a))}),$(document).on("click","#custom",function(){$("#modalCustom").modal("open")}),$(document).on("click","#modalCustom, #modalCustom .closed",function(){$("#modalCustom").modal("closed")}),$(document).on("mouseenter",".bill_tab span",function(){$(this).find("i").show()}),$(document).on("mouseleave",".bill_tab span",function(){$(this).find("i").hide()}),$(document).on("click",".userType .addbtn",function(){$("#modalUserType").modal("open")}),$(document).on("click","#modalUserType, #modalUserType .closed",function(){$("#modalUserType").modal("closed")}),$(document).on("click",".packageType .addbtn",function(){var a=$(".userType .bill_tab span.on").length;a>0?$("#modalPackageType").modal("open"):alert("请选择一个【上网类型】！没有【上网类型】，请新增一个！")}),$(document).on("click","#modalPackageType, #modalPackageType .closed",function(){$("#modalPackageType").modal("closed")}),$(document).on("click","#modalPackageType .adsnav li",function(){var a=$(this).index();$(this).addClass("on").siblings().removeClass("on"),a>0?($(".vtime input").removeClass("checkFloat").addClass("checkInt"),$(".vtime input").attr("placeholder","输入天数").val("")):($(".vtime input").removeClass("checkInt").addClass("checkFloat"),$(".vtime input").attr("placeholder","支持两位小数，例如：1.52").val("")),$(".vtime .errormsg").remove(),$(".vtime input").removeClass("error")}),$(document).on("click","#modalPackageType .add",function(){var a=$(".userType .bill_tab span.on").attr("data-user-type-id"),b=$("#modalPackageType .adsnav li.on").index(),c=$(".userType span.on").index(),d=$("input[name=price]").val(),e=$("input[name=time]").val(),f=""==$("input[name=ends]").val()?2:$("input[name=ends]").val(),g=$("input[name=expired]").val(),h=$("input[name=label]").val();if(0==checkInput($("#modalPackageType .verify"))){var i={location:$("#location").val(),price:d,ends:f,expired:g,label:h,web_type_id:a};0==c&&(i.isguest=1),b>0?(i.time=24*e,i.mask=2):(i.time=e,i.mask=1),billAjax("post",i,function(a){if(200==a.code){if($("#modalPackageType").modal("closed"),""==h)if(b>0)var c='<span data-pay-id="'+a.pay_policy_id+'">'+d+"元 = "+e+"天<i></i></span>";else var c='<span data-pay-id="'+a.pay_policy_id+'">'+d+"元 = "+e+"小时<i></i></span>";else var c='<span data-pay-id="'+a.pay_policy_id+'">'+h+"<i></i></span>";$(".packageType .bill_tab").append(c)}})}}),$(document).on("click",".packageType span i",function(a){a.stopPropagation();var b=$(this),c=$(this).parent().attr("data-pay-id");confirm("确定要删除？")&&billAjax("delete",{pay_policy_id:c},function(a){200==a.code&&b.parent().remove()})}),$(document).on("click","#sensTable .edit",function(a){console.log(a),a.stopPropagation()}),$(document).on("click",".userType .bill_tab span",function(){var a=$(this).attr("data-user-type-id"),b=$(this);billAjax("get",{web_type_id:a},function(a){if(200==a.code){b.addClass("on").siblings().removeClass("on");for(var c="",d=0,e=a.policys.length;d<e;d++){if(""==a.policys[d].label)if(2==a.policys[d].mask)var f='<span data-pay-id="'+a.policys[d].id+'">'+a.policys[d].price+"元 = "+a.policys[d].time/24+"天<i></i></span>";else var f='<span data-pay-id="'+a.policys[d].id+'">'+a.policys[d].price+"元 = "+a.policys[d].time+"小时<i></i></span>";else var f='<span data-pay-id="'+a.policys[d].id+'">'+a.policys[d].label+"<i></i></span>";c+=f}$(".packageType .bill_tab").html(c)}})}),$(document).on("click","#modalUserType .add",function(){var a=$("input[name=nameType]").val(),b=parseInt($("#userTypeLen").val()),c=$("#location").val();if(0==checkInput($(this).parent().parent())){var d={location:c,name:a};billWebTypeFunc("post",d,function(c){if(200==c.code){$("#modalUserType").modal("closed");var d='<span data-user-type-id="'+c.web_type_id+'">类型'+(b+1)+"："+a+"<i></i></span>";$(".userType .bill_tab").append(d),$("#userTypeLen").val(b+1)}})}}),$(document).on("click",".userType span i",function(a){a.stopPropagation();var b=$(this),c=$(this).parent().index();confirm("确定要删除？")&&c>0&&billWebTypeFunc("delete",{web_type_id:$(this).parent().attr("data-user-type-id")},function(a){200==a.code&&(b.hasClass("on")&&$(".packageType .bill_tab").empty(),b.parent().remove())})}),$(document).on("click","#modalpay .edit",function(){var a=$("#location").val(),b=$("#modalpay input[name=id]").val(),c=$("#modalpay input[name=pid]").val(),d=$("#modalpay input[name=skey]").val(),e=$("#modalpay #rsakey").siblings("input[name=rsa]").val();if(0==checkInput($("#modalpay .veright"))){var f={location:a,seller_id:b,partner:c,key:d,rsa_private_key_url:e,platform:"alipay"};payFunc(f,function(a){200==a.code?($("#alipay div span").text(b),$("#modalpay input[name=id]").parent().parent().data("value",b),$("#modalpay input[name=pid]").parent().parent().data("value",c),$("#modalpay input[name=key]").parent().parent().data("value",d),$("#modalpay input[name=rsa]").parent().parent().data("value",e),$("#modalpay").modal("closed")):console.log(a)})}}),$(document).on("click","#alipay div button",function(){$("#modalpay input[name=payHid]").val("alipay"),$("#modalpay .veright").each(function(a,b){var c=$(b).data("value");!$(b).find("input[type=file]").length>0&&$(b).find("input").val(c)}),$("#modalpay").modal("open")}),$(document).on("click","#modalpay, #modalpay .closed",function(){$("#modalpay").modal("closed")}),$(document).on("change",".profile",function(){uploadfile($(this).attr("id"))}),$(document).on("click","#modalwxpay .edit",function(){var a=$("#location").val(),b=$("#modalwxpay input[name=appid]").val(),c=$("#modalwxpay input[name=mchid]").val(),d=$("#modalwxpay input[name=key]").val();if(0==checkInput($("#modalwxpay .veright"))){var e={location:a,appid:b,mch_id:c,key:d,platform:"wxpay"};payFunc(e,function(a){200==a.code?($("#wechat div span").text(b),$("#modalwxpay input[name=appid]").parent().parent().data("value",b),$("#modalwxpay input[name=mchid]").parent().parent().data("value",c),$("#modalwxpay input[name=key]").parent().parent().data("value",d),$("#modalwxpay").modal("closed")):console.log(a)})}}),$(document).on("click","#wechat div button",function(){$("#modalwxpay input[name=payHid]").val("alipay"),$("#modalwxpay .veright").each(function(a,b){var c=$(b).data("value");!$(b).find("input[type=file]").length>0&&$(b).find("input").val(c)}),$("#modalwxpay").modal("open")}),$(document).on("click","#modalwxpay, #modalwxpay .closed",function(){$("#modalwxpay").modal("closed")}),$("#uploadfile").on("click",function(a){a.preventDefault(),$("#xlsfile").trigger("click")}),$("#xlsfile").change(function(){var a=$("#location").val(),b=$(this).attr("id"),c=$(this).parent(),d='<em style="color:#67d58e;"><i class="loading"></i>正在上传...</em>';c.append(d),$.ajaxFileUpload({type:"post",url:proUrl+"user_template",data:{location:a},secureuri:!1,fileElementId:b,dataType:"json",success:function(a,b){window.location.reload()},error:function(a,b,c){console.log(c)}})}),$("#uploadfileInner").on("click",function(a){a.preventDefault(),$("#xlsfileInner").trigger("click")}),$("#xlsfileInner").change(function(){var a=$("#location").val(),b=$(this).attr("id"),c=$(this).parent(),d='<em style="color:#67d58e;"><i class="loading"></i>正在上传...</em>';c.append(d),$.ajaxFileUpload({type:"post",url:proUrl+"inneruser_template.xls",data:{location:a},secureuri:!1,fileElementId:b,dataType:"json",success:function(a,b){window.location.reload()},error:function(a,b,c){console.log(c)}})});var checkImgNone=function(a){var b=$(a).attr("src");"None"==b&&$(a).attr("src","/static/images/cover/defaultImg.jpg")};checkImgNone(".surveyImg img"),$(".protab .tabimg img").map(function(a,b){checkImgNone(b);var c,d,e,f=290;$("<img/>").attr("src",$(b).attr("src")).load(function(){c=this.width,d=this.height,c>=f&&($(b).css("width",f+"px"),e=Math.floor(f*d/c),e<92&&$(b).css("height","92px"))})}),$(".pubtab .tabimg img").each(function(a,b){var c;$("<img/>").attr("src",$(b).attr("src")).load(function(){c=this.width,c>=200&&$(b).css("height","220px")})}),$(document).on("click",".veright img",function(){$(this).hasClass("staySize")||($("#modalImg img").attr("src",$(this).attr("src")).load(function(){var a=this.width;$(".modal_img").css({width:a+"px","margin-left":-Math.ceil(a/2)+"px"})}),$("#modalImg").modal("open"))}),$(document).on("click","#modalImg, #modalImg .closed",function(){$("#modalImg").modal("closed")}),$(document).on("click",".defaultportal img",function(){$("#modalImg img").attr("src",$(this).data("src")).load(function(){var a=this.width;$(".modal_img").css({width:a+"px","margin-left":-Math.ceil(a/2)+"px"})}),$("#modalImg").modal("open")}),$(document).on("click",".file button",function(a){a.preventDefault(),$(this).prev("input[type=file]").trigger("click")}),$("#uploadImg").change(function(){return $(".loading").show(),$.ajaxFileUpload({url:imgUrl,secureuri:!1,fileElementId:"uploadImg",success:function(a,b){console.log(a),$(".loading").hide();var c=$(a).find("body").text(),d=$.parseJSON(c);$(".imgVal").val(d.url),$(".showImg img").attr("src",cmsUrl+d.url),$(".showImg").show()},error:function(a,b,c){console.log(c)}}),!1}),$(document).on("click",".deluploadImg",function(){$(this).parent().prev().find("input:eq(0)").val(""),$(this).prev("img").attr("src",""),$(this).parent().hide()}),$(".proImg").change(function(){ajaxImg($(this).attr("id"),$(this).attr("imgElementId"),$(this))}),$(document).on("click",".usermem .areabox button",function(){var a=$(this).index();$(".proMobileCls").eq(a).show().siblings().hide(),$(".news").eq(a).show().siblings(".news").hide(),$(this).addClass("on").siblings().removeClass("on")}),$(document).on("click","#addnewsgroup",function(){$trThis=$(this),$("#modalnewsgroup").modal("open")}),$(document).on("click","#modalnewsgroup, #modalnewsgroup .closed",function(){$("#modalnewsgroup").modal("closed")}),$(document).on("click","#modalnewsgroup .add",function(){if(0==checkInput($("#modalnewsgroup .veright"))){var a=$("#modalnewsgroup input[name=name]").val(),b='<button type="button" class="btnGraySmall">'+a+"</button>";$trThis.parents(".toolnav").next(".areabox").append(b),$("#modalnewsgroup").modal("closed")}}),$(".sel_date:eq(0)").show(),$(document).on("change",".dateorhour",function(){var a=$(this).val();$(".sel_date").eq(a).show().siblings(".sel_date").hide()}),$(document).on("click","#cmpTime",function(){var a=$(".dateorhour").val();if(0==a)var b=$("#datepicker").val(),c="date="+b;else var d=$("#dateStart").val(),e=$("#dateEnd").val(),c="start="+d+"&end="+e;myLine=echarts.init(document.getElementById("chartLineContent"),"macarons"),myLine.showLoading(),$.ajax({method:"get",url:proUrl+"aps/stat/?"+c,dataType:"json",success:function(b){myLine.hideLoading();var c=getStat(b.stat,a);opLine(c.b,c.c,c.d,c.a,a)}})});var chkpwd=function(a){if(""==a)var b='<td data-value="'+a+'"></td>';else var b='<td data-value="'+a+'" data-tip="'+a+'" class="pwdtip">***</td>';return b};$(document).on("click","#aclist .edit",function(){$trThis=$(this).parent().parent().find("td");var a=$(this).siblings("input[name=id]").val(),b=parseInt($trThis.eq(-1).find("input[name=mask]").val()).toString(2),c=("000"+b).substr(-3).match(/\d/g);$("#modalAC #account").val(parseInt(c[0])),$("#modalAC #auto").val(parseInt(c[1])),$("#modalAC #mask").val(parseInt(c[2])),1==parseInt(c[2])?($("#modalAC .autoInput").parent().parent().show(),$("#modalAC .autoInput em").text($trThis.eq(-1).find("input[name=locate]").attr("title")),$("#modalAC .autoInput").attr("title",$trThis.eq(-1).find("input[name=locate]").attr("title")),$("#modalAC .autoInput").attr("data-locate",$trThis.eq(-1).find("input[name=locate]").attr("data-locate"))):$("#modalAC .autoInput").parent().parent().hide(),$("#modalAC .fill").each(function(a,b){$(b).val($trThis.eq(a).data("value"))}),$("#modalAC input[name=secret]").val($trThis.eq(-1).find("input[name=secret]").val()),$("#modalAC input[name=id]").val(a),$("#modalAC h3").text("编辑AC"),$("#modalAC .autoInput").addClass("autoAC"),$("#modalAC .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),
$("#modalAC").modal("open")}),$(document).on("click","#aclist .add",function(){$("#modalAC h3").text("新增AC"),$("#modalAC #mask").val(0),$("#modalAC #auto").val(0),$("#modalAC #account").val(0),$("#modalAC .autoInput em").text("请选择"),$("#modalAC .autoInput").removeClass("autoAC").attr({title:"","data-locate":""}).parent().parent().hide(),$("#modalAC .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalAC").modal("open")}),$(document).on("click","#modalAC, #modalAC .closed",function(){$("#modalAC").modal("closed")}),$(document).on("click","#modalAC .save",function(){var a=$("#modalAC input[name=secret]").val(),b=$("#modalAC #mask").val(),c=$("#modalAC #auto").val(),d=$("#modalAC #account").val(),e=parseInt(d.toString()+c.toString()+b.toString(),2);if(0==checkInput($(this).parent().parent())){var f={name:$("#modalAC input[name=name]").val(),ip:$("#modalAC input[name=ip]").val(),vendor:$("#vendor").val(),model:$("#modalAC input[name=model]").val(),user:$("#modalAC input[name=user]").val(),password:$("input[name=password]").val(),pri:$("#prisq").val(),ac_id:$("#modalAC input[name=id]").val(),mask:e,secret:a};acAjax("put",f,function(b){200==b.code&&($("#modalAC .fill").each(function(a,b){$trThis.eq(a).data("value",$(b).val()),$(b).is("select")?$trThis.eq(a).html(changeSelectFunc($(b).attr("id"),$(b).val())):"password"==$(b).attr("name")?($trThis.eq(a).data("tip",$(b).val()),$trThis.eq(a).text("***")):$trThis.eq(a).text($(b).val())}),$trThis.eq(-1).find("input[name=mask]").val(e),$trThis.eq(-1).find("input[name=secret]").val(a),$("#modalAC").modal("closed"))})}}),$(document).on("click","#modalAC .add",function(){var a=$("#modalAC input[name=name]").val(),b=$("#modalAC input[name=ip]").val(),c=$("#vendor").val(),d=$("#modalAC input[name=model]").val(),e=$("#modalAC input[name=user]").val(),f=$("#modalAC input[name=password]").val(),g=$("#prisq").val(),h=$("#mask").val(),i=$("#auto").val(),j=$("#account").val(),k=$("#modalAC input[name=secret]").val(),l=parseInt(j.toString()+i.toString()+h.toString(),2);if(0==checkInput($(this).parent().parent())){var m={name:a,ip:b,vendor:c,model:d,user:e,password:f,pri:g,mask:l,secret:k};acAjax("post",m,function(g){if(200==g.code)if(1==h){var i=$(".autoInput").attr("data-locate"),j=$(".autoInput").attr("title"),m=g.ac_id,n={id:m,location:i};acbindAjax(n,function(g){if(200==g.code){var h='<tr><td data-value="'+a+'">'+a+'</td><td data-value="'+b+'">'+b+'</td><td data-value="'+c+'">'+changevendor(c)+'</td><td data-value="'+d+'">'+d+'</td><td data-value="'+e+'">'+e+"</td>"+chkpwd(f)+'<td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+m+'" name="id" /><input type="hidden" value="'+l+'" name="mask" /><input type="hidden" value="'+k+'" name="secret" /><input type="hidden" name="locate" data-locate="'+i+'" data-name="'+j+'" /></td></tr>';$("#aclist table tr:eq(0)").after(h),$("#modalAC").modal("closed")}})}else{var o='<tr><td data-value="'+a+'">'+a+'</td><td data-value="'+b+'">'+b+'</td><td data-value="'+c+'">'+changevendor(c)+'</td><td data-value="'+d+'">'+d+'</td><td data-value="'+e+'">'+e+"</td>"+chkpwd(f)+'<td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+g.ac_id+'" name="id" /><input type="hidden" value="'+l+'" name="mask" /><input type="hidden" value="'+k+'" name="secret" /><input type="hidden" name="locate" data-locate="" data-name="" /></td></tr>';$("#aclist table tr:eq(0)").after(o),$("#modalAC").modal("closed")}})}}),$(document).on("click","#aclist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&acAjax("delete",{ac_id:$(this).parent().find("input[name=id]").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):alert("删除失败！")})}),$(document).on("change","#modalAC #mask",function(){1==$(this).val()?$("#modalAC .autoInput").parent().parent().show():$("#modalAC .autoInput").parent().parent().hide()});var selop=$(".selHid").prop("outerHTML");$(document).on("click","#aplist .edit",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);2==b&&(c.html('<div class="autoInput autoDom" title="'+c.attr("data-title")+'" data-locate="'+c.attr("data-value")+'"><em>'+c.attr("data-title")+"</em></div>"),$(".autoDom").mySelect()),5==b&&c.html('<input type="text" value="'+c.data("value")+'" style="width:250px;" />')}a.eq(a.length-1).find("span").hide(),a.eq(a.length-1).find("button").show()}),$(document).on("click","#aplist .cancel",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);2==b&&c.html(c.attr("data-title")),5==b&&c.html(c.data("value"))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}),$(document).on("click","#aplist .save",function(){var a=$(this).parent().parent().find("td"),b=a.eq(2).find("div em").text(),c=a.eq(2).find(".autoInput").attr("data-locate"),d=a.eq(1).data("value"),e=a.eq(5).find("input").val(),f={location:c,mac:d,address:e};apAjax("put",f,function(d){if(200==d.code){for(var f=0;f<a.length-1;f++){var g=a.eq(f);2==f&&(g.html(b),g.attr("data-title",b),g.attr("data-value",c)),5==f&&(g.html(e),g.data("value",e))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find(".edit").show()}else console.log(d)})}),$(document).on("click","#apslist .edit",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);1==b&&(c.html('<div class="autoInput autoDom" title="'+c.attr("data-title")+'" data-locate="'+c.attr("data-value")+'"><em>'+c.attr("data-title")+"</em></div>"),$(".autoDom").mySelect()),4==b&&c.html('<input type="text" value="'+c.data("value")+'" style="width:200px;" />')}a.eq(a.length-1).find("span").hide(),a.eq(a.length-1).find("button").show()}),$(document).on("click","#apslist .cancel",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);1==b&&c.html(c.attr("data-title")),4==b&&c.html(c.data("value"))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}),$(document).on("click","#apslist .save",function(){var a=$(this).parent().parent().find("td"),b=a.eq(1).find("div em").text(),c=a.eq(1).find(".autoInput").attr("data-locate"),d=a.eq(0).data("value"),e=a.eq(4).find("input").val(),f={location:c,mac:d,address:e};apAjax("put",f,function(d){if(200==d.code){for(var f=0;f<a.length-1;f++){var g=a.eq(f);1==f&&(g.html(b),g.attr("data-title",b),g.attr("data-value",c)),4==f&&(g.html(e),g.data("value",e))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}else console.log(d)})}),$(document).on("click",".headunchk",function(a){a.stopPropagation(),$(this).toggleClass("headchk")}),$(document).on("click",".unchk",function(a){a.stopPropagation(),$(this).toggleClass("chk")}),$(document).on("click",".allchk",function(){$(this).hasClass("chk")?$("#aplist tr:gt(0) .unchk").addClass("chk"):$("#aplist tr:gt(0) .unchk").removeClass("chk")}),$(document).on("click","#apbind",function(){var a=$(this).prev(".autoInput");if(a.attr("data-locate")){$(this).next("i").hide();var b=[];if($("#aplist tr:gt(0) .chk").each(function(a,c){var d=$(c).parent().parent().find("td:eq(1)").data("value");b.push(d)}),b.length>0){if(confirm("绑定选中AP")){var c={location:a.attr("data-locate"),macs:b.join(",")};apbindAjax(c,function(a){200==a.code?window.location.reload():alert("批量绑定失败！")})}}else $(this).next("i").text("*请勾选需要批量绑定的AP").show()}else $(this).next("i").text("*请选择所属项目").show()}),$(document).on("click",".unchk_b",function(a){a.stopPropagation(),$(this).toggleClass("chk_b")}),$(document).on("click",".allchk_b",function(){$(this).hasClass("chk_b")?$(".aptable tr:gt(0) .unchk_b").addClass("chk_b"):$(".aptable tr:gt(0) .unchk_b").removeClass("chk_b")}),$(document).on("click","#apeditgroup .add",function(){var a=[];if(0==checkInput($("#apeditgroup .veright"))){$(".aptable tr:gt(0) .chk_b").each(function(b,c){var d=$(c).parent().parent().find("td:eq(1)").text();a.push(d)});var b={location:$("#location").val(),name:$("#apeditgroup input[name=name]").val(),macs:a.join(",")};apgroupAjax("post",b,function(a){200==a.code?window.location.href="/apgroups.html?location="+$("#location").val():alert("新增失败")})}}),$(document).on("click","#apeditgroup .edit",function(){var a=[];if(0==checkInput($("#apeditgroup .veright"))){$(".aptable tr:gt(0) .chk_b").each(function(b,c){var d=$(c).parent().parent().find("td:eq(1)").text();a.push(d)});var b={ap_group_id:$("#apgroupId").val(),name:$("#apeditgroup input[name=name]").val(),macs:a.join(",")};apgroupAjax("put",b,function(a){200==a.code?window.location.href="/apgroups.html?location="+$("#location").val():alert("新增失败")})}}),$(document).on("click","#apgroups .delbtn",function(){if(confirm("确定要删除此AP组吗？")){var a=$("#apgroups .navlink .act").data("id");apgroupAjax("delete",{ap_group_id:a},function(a){200==a.code?window.location.reload():alert("删除失败!")})}}),$(document).on("click","#apeditgroup .reback, .userinfoReback",function(){history.back()}),$(document).on("click",".ns_role .headunchk",function(){$(this).hasClass("headchk")?$(this).parent().parent().next("div").find(".unchk").addClass("chk"):$(this).parent().parent().next("div").find(".unchk").removeClass("chk")}),$(document).on("click",".ns_role .unchk",function(){var a=$(this).parent().parent(),b=a.find(".chk").length;0==b?a.prev("p").find(".headunchk").removeClass("headchk"):a.prev("p").find(".headunchk").addClass("headchk")});var checkRole=function(a){for(var b=[],c=0;c<a.length;c++)if(a.eq(c).hasClass("headchk")){var d={},e=[];d.resource=a.eq(c).parent().data("resource");for(var f=a.eq(c).parent().parent().next("div"),g=0,h=f.find("i");g<h.length;g++)h.eq(g).hasClass("chk")&&e.push(h.eq(g).parent().data("operation")),d.operation=e;b.push(d)}return b};$(document).on("click","#roleAdd",function(){var a=$("input[name=roleName]").val(),b=$("#location").val();if(""==a)return alert("请输入角色名称！"),!1;var c=checkRole($("#roleOpra .headunchk")),d={role:a,acl:JSON.stringify(c)};roleAjax("post",d,function(a){200==a.code?window.location.href="/admin.html?location="+b:(console.log(a),alert("新增失败"))})}),$(document).on("click","#roleSave",function(){var a=checkRole($("#roleOpra .headunchk")),b=$("#location").val(),c={role:$("#role").val(),acl:JSON.stringify(a)};roleAjax("put",c,function(a){200==a.code?window.location.href="/admin.html?location="+b:(console.log(a),alert("保存失败"))})}),$(document).on("change","#role",function(){console.log("已触发"),roleAjax("get",{role:$(this).val()},function(a){200==a.code?($("#roleOpra p label i").removeClass("headchk"),$("#roleOpra div label i").removeClass("chk"),a.acl.map(function(a){for(var b=0,c=$("#roleOpra p label");b<c.length;b++)if(a.resource==c.eq(b).data("resource")){c.eq(b).find("i").addClass("headchk");var d=c.eq(b).parent().next("div");a.operation.map(function(a){for(var b=0,c=d.find("label");b<c.length;b++)a==c.eq(b).data("operation")&&c.eq(b).find("i").addClass("chk")})}})):console.log(a)})}),$(document).on("click","#fiberlist .add",function(){$("#modalFiber h3").text("新增宽带"),$("#modalFiber .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalFiber").modal("open")}),$(document).on("click","#fiberlist .edit",function(){var a=$(this).parent().parent().find("td"),b=$(this).siblings("input").val(),c=$(this).parent().parent().index();$("#modalFiber .veright input").each(function(b,c){$(c).val(a.eq(b).data("value"))}),$("#modalFiber input[name=id]").val(b),$("#modalFiber input[name=idx]").val(c),$("#modalFiber h3").text("编辑宽带"),$("#modalFiber .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),$("#modalFiber").modal("open")}),$(document).on("click","#modalFiber, #modalFiber .closed",function(){$("#modalFiber").modal("closed")}),$(document).on("click","#modalFiber .save",function(){var a=$("#modalFiber input[name=idx]").val();if(0==checkInput($("#modalFiber .veright"))){var b={type_id:$("#fiberlist .adsnav li.on").data("id"),line:$("input[name=line]").val(),start:$("input[name=start]").val(),end:$("input[name=end]").val(),telecom:$("input[name=telecom]").val(),fiber_id:$("#modalFiber input[name=id]").val()};fiberAjax("put",b,function(b){200==b.code?($("#modalFiber .veright input").each(function(b,c){$("#fiberlist table tr").eq(a).find("td").eq(b).data("value",$(c).val()),$("#fiberlist table tr").eq(a).find("td").eq(b).text($(c).val())}),$("#modalFiber").modal("closed")):console.log(b)})}}),$(document).on("click","#modalFiber .add",function(){var a=$("input[name=line]").val(),b=$("input[name=start]").val(),c=$("input[name=end]").val(),d=$("input[name=telecom]").val();if(0==checkInput($("#modalFiber .verify"))){var e={type_id:$("#fiberlist .adsnav li.on").data("id"),line:a,start:b,end:c,telecom:d};fiberAjax("post",e,function(e){if(200==e.code){var f='<tr><td data-value="'+a+'">'+a+'</td><td data-value="'+b+'">'+b+'</td><td data-value="'+c+'">'+c+'</td><td data-value="'+d+'">'+d+'</td><td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+e.fiber_id+'" /></td></tr>';$("#fiberlist table tr:eq(0)").after(f),$("#modalFiber").modal("closed")}else console.log(e)})}}),$(document).on("click","#fiberlist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&fiberAjax("delete",{fiber_id:$(this).siblings("input").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):console.log(b)})}),$(document).on("click","#fiberlist .adsnav li",function(){var a=$(this);a.hasClass("on")||fiberAjax("get",{type_id:a.data("id")},function(b){if(200==b.code){a.addClass("on").siblings().removeClass("on");for(var c=b.fibers.length,d="",e=0;e<c;e++){var f='<tr><td data-value="'+b.fibers[e].line+'">'+b.fibers[e].line+'</td><td data-value="'+b.fibers[e].start+'">'+b.fibers[e].start+'</td><td data-value="'+b.fibers[e].end+'">'+b.fibers[e].end+'</td><td data-value="'+b.fibers[e].telecom+'">'+b.fibers[e].telecom+'</td><td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+b.fibers[e].id+'" /></td></tr>';d+=f}$("#fiberlist table tr:gt(0)").remove(),$("#fiberlist table").append(d)}else console.log(b)})}),$(document).on("click","#pnlist .edit",function(){$trThis=$(this).parent().parent().find("td");var a=$trThis.eq(-1).find("input.id").val(),b=parseInt($trThis.eq(-1).find("input.policy").val()).toString(2),c=("00000000000"+b).substr(-11).match(/\d/g);$("#modalPn input[name=id]").val(a),$("#modalPn input[name=idx]").val(0),$("#modalPn #mobileRZ").val(c[0]),$("#modalPn #wechatRZ").val(c[1]),$("#modalPn #accountRZ").val(c[2]),$("#modalPn #pri").val(c[9]),$("#modalPn #policy").val(c[10]),$("#modalPn input[name=ssid]").val($trThis.eq(3).text()),$("#modalPn input[name=note]").val($trThis.eq(4).text()),$("#modalPn #portal").val($trThis.eq(5).data("value")),$("#modalPn input[name=appid]").val($trThis.eq(6).text()),$("#modalPn input[name=shopid]").val($trThis.eq(7).text()),$("#modalPn input[name=secret]").val($trThis.eq(8).text()),$("#modalPn input[name=duration]").val($trThis.eq(9).text()),$("#modalPn input[name=stout]").val($trThis.eq(-1).find("input.stout").val()),$("#modalPn h3").text("编辑网络配置"),$("#modalPn .btngroups").html('<button type="button" class="btnBlue edit">保存</button>'),$("#modalPn").modal("open")}),$(document).on("click","#pnlist .addbtn",function(){$("#modalPn h3").text("新增网络配置"),$("#modalPn #accountRZ").val(1),$("#modalPn #wechatRZ").val(1),$("#modalPn #mobileRZ").val(1),$("#modalPn #pri").val(0),$("#modalPn #policy").val(0),$("#modalPn .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalPn").modal("open")}),$(document).on("click","#modalPn, #modalPn .closed",function(){$("#modalPn").modal("closed")}),$(document).on("click","#modalPn .add",function(){var a=$("#pri").val(),b=$("#policy").val(),c=$("#accountRZ").val(),d=$("#wechatRZ").val(),e=$("#mobileRZ").val();if(0==checkInput($(this).parent().parent())){var f={location:$("#location").val(),policy:parseInt(e.toString()+d.toString()+c.toString()+"000000"+a.toString()+b.toString(),2),ssid:$("input[name=ssid]").val(),note:$("input[name=note]").val(),portal:$("#portal").val(),appid:$("input[name=appid]").val(),shopid:$("input[name=shopid]").val(),secret:$("input[name=secret]").val(),duration:$("input[name=duration]").val()};pnAjax("post",f,function(a){200==a.code?window.location.reload():console.log(a)})}}),$(document).on("click","#pnlist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&pnAjax("delete",{policy_id:a.parent().find("input").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):console.log(b)})}),$(document).on("click","#policylist .smore",function(){var a=$(this).parent().parent().next(".insideTable").find("div");a.is(":hidden")?($(this).parent().parent().next(".insideTable").find("div").slideDown(),$(this).html('收起<i class="aUp"></i>')):($(this).parent().parent().next(".insideTable").find("div").slideUp(),$(this).html('展开<i class="aDwn"></i>'))});var ycselect="";$(document).on("click","#policylist .edit",function(){$trThis=$(this).parent().parent().find("td");var a=$trThis.eq(-1).find("input.id").val(),b=parseInt($trThis.eq(-1).find("input.policy").val()).toString(2),c=("00000000000"+b).substr(-11).match(/\d/g);$("#modalPn input[name=id]").val(a),$("#modalPn input[name=idx]").val(1),$("#modalPn #mobileRZ").val(c[0]),$("#modalPn #wechatRZ").val(c[1]),$("#modalPn #accountRZ").val(c[2]),$("#modalPn #pri").val(c[9]),$("#modalPn #policy").val(c[10]),$("#modalPn input[name=ssid]").val($trThis.eq(3).text()),$("#modalPn input[name=note]").val($trThis.eq(4).text()),$("#modalPn input[name=appid]").val($(this).siblings(".appid").val()),$("#modalPn input[name=shopid]").val($(this).siblings(".shopid").val()),$("#modalPn input[name=secret]").val($(this).siblings(".secret").val()),$("#modalPn input[name=stout]").val($trThis.eq(-1).find("input.stout").val());var d=$trThis.eq(0).text();29946==d?($("#modalPn .durationRZ").html('<label><i>*</i>免认证(小时) </label><span class="veright"><div class="verify"><input type="text" name="duration" placeholder="输入小时，例如：5" class="matchVerify shouldVerify checkInt" /></div></span>'),""==ycselect?portalAjax("get","","",function(a){if(console.log(a),200==a.Code){ycselect='<select id="portal"><option value="login_yczone.html">login_yczone.html</option>';for(var b=0;b<a.templates.length;b++){var c=a.templates[b];ycselect+='<option value="'+c+'">'+c+"</option>"}ycselect+="</select>",$("#modalPn .portalRZ .verify").html(ycselect)}else console.log(a)}):$("#modalPn .portalRZ .verify").html(ycselect)):($("#modalPn .durationRZ").html('<label><i>*</i>免认证(天) </label><span class="veright"><div class="verify"><input type="text" name="duration" placeholder="输入天数，例如：5" class="matchVerify shouldVerify checkInt" /></div></span>'),$("#modalPn .portalRZ .verify").html('<input type="text" class="matchVerify shouldVerify" id="portal" />')),$("#modalPn #portal").val($trThis.eq(5).data("value")),$("#modalPn input[name=duration]").val($(this).siblings(".duration").val()),$("#modalPn h3").text("编辑网络配置"),$("#modalPn .btngroups").html('<button type="button" class="btnBlue edit">保存</button>'),$("#modalPn").modal("open")}),$(document).on("click","#modalPn .edit",function(){var a=$("#modalPn input[name=idx]").val(),b=$("#modalPn #pri").val(),c=$("#modalPn #pri option:selected").text(),d=$("#modalPn #policy").val(),e=$("#modalPn #policy option:selected").text(),f=$("#modalPn #accountRZ").val(),g=$("#modalPn #wechatRZ").val(),h=$("#modalPn #mobileRZ").val(),i=$("#modalPn input[name=ssid]").val(),j=$("#modalPn input[name=note]").val(),k=$("#modalPn #portal").val(),l=$("#modalPn input[name=appid]").val(),m=$("#modalPn input[name=shopid]").val(),n=$("#modalPn input[name=secret]").val(),o=$("#modalPn input[name=duration]").val(),p=$("#modalPn input[name=stout]").val(),q=parseInt(h.toString()+g.toString()+f.toString()+"000000"+b.toString()+d.toString(),2);if(0==checkInput($("#modalPn .veright"))){var r={policy_id:$("#modalPn input[name=id]").val(),policy:q,ssid:i,note:j,portal:k,appid:l,shopid:m,secret:n,duration:o,session_timeout:p};console.log(r),pnAjax("put",r,function(f){200==f.code?(1==a?($trThis.eq(1).html(c+'<input type="hidden" value="'+b+'" />'),$trThis.eq(2).html(e+'<input type="hidden" value="'+d+'" />'),$trThis.eq(3).text(i),$trThis.eq(4).text(j),$trThis.eq(5).text(k),$trThis.eq(5).data("value",k),$trThis.eq(-1).find(".appid").val(l),$trThis.eq(-1).find(".shopid").val(m),$trThis.eq(-1).find(".secret").val(n),$trThis.eq(-1).find(".duration").val(o),$trThis.eq(-1).find(".policy").val(q),$trThis.eq(-1).find(".stout").val(p)):($trThis.eq(1).html(c+'<input type="hidden" value="'+b+'" />'),$trThis.eq(2).html(e+'<input type="hidden" value="'+d+'" />'),$trThis.eq(3).text(i),$trThis.eq(4).text(j),$trThis.eq(5).text(k),$trThis.eq(5).data("value",k),$trThis.eq(6).text(l),$trThis.eq(7).text(m),$trThis.eq(8).text(n),$trThis.eq(9).text(o),$trThis.eq(-1).find("input.policy").val(q),$trThis.eq(-1).find("input.stout").val(p)),$("#modalPn").modal("closed")):console.log(f)})}}),$(document).on("click","#policylist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&pnAjax("delete",{policy_id:a.parent().find("input.id").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):console.log(b)})}),$(document).on("click",".delsgt",function(){confirm("确定要删除吗？")&&$(this).parent().parent().remove()}),$(document).on("click","#addsgt",function(){var a=Math.round(1e5*Math.random()),b='<tr><td><input type="text" class="sgtName" /></td><td class="file"><input type="hidden" /><input type="file" class="uploadImg sgtImg" id="sgtImg'+a+'" name="uploadImg" /><button type="button" class="btnGreen">上传施工图</button><div class="loading"></div><em></em><div class="delsgt"></div></td></tr>';($(".sgt tr").length<2||""!=$(".sgtName").val())&&$(".sgt").append(b)}),$(document).on("change",".sgtName",function(){""==$.trim($(this).val())?$(this).parent().next(".file").find("input[type=hidden]").removeClass("shouldVerify checkFile"):$(this).parent().next(".file").find("input[type=hidden]").addClass("shouldVerify checkFile")}),$(document).on("change",".sgtImg",function(){ajaxImgSec($(this).attr("id"),$(this))}),$(document).on("click","#addFields",function(){if(0==checkIpu($(".exwords"))){var a='<tr class="extr"><td><i class="uncheck_s on"></i></td><td><input type="text" class="title" /></td><td><input type="text" class="column matchVerify checkEng" /></td><td><select class="extype"><option value="string">字符串(String)</option><option value="int">整型(Int)</option><option value="float">浮点型(Float)</option><option value="datetime">日期(Date)</option><option value="password">密码(Password)</option><option value="img">图片(Img)</option></select></td></tr>';$(".exwords").append(a)}});var exfield=!1;$(document).on("change","#resId",function(){8==$(this).val()?($(".exfields").show(),exfield=!0):($(".exfields").hide(),$(".exfields .errormsg").remove(),exfield=!1)}),$(document).on("click","#addRes",function(){var a=$("#location").val(),b=[],c=[];c=0==a.indexOf("29946")?[{type:"string",column:"mobile",title:"电话号码",is_profile:1},{type:"string",column:"name",title:"姓名",is_profile:1},{type:"string",column:"department",title:"部门",is_profile:1},{type:"string",column:"position",title:"职位",is_profile:1},{type:"string",column:"mail",title:"邮箱",is_profile:1},{type:"int",column:"mask",title:"mask",is_profile:0},{type:"string",column:"user",title:"user",is_profile:0}]:[{type:"string",column:"mobile",title:"电话号码",is_profile:1}];var d=[{type:"string",column:"room",title:"房间号",is_profile:1},{type:"string",column:"mobile",title:"电话号码",is_profile:1},{type:"string",column:"user",title:"上网账号",is_profile:1},{type:"password",column:"password",title:"密码",is_profile:1},{type:"datetime",column:"expired",title:"到期时间",is_profile:1}];if(checkInput($(".veright"))>0)return!1;exfield&&($(".exfields .innerTable table tr.extr").each(function(a,b){var d={};0==checkIpu($(b))&&(d.title=$(b).find(".title").val(),d.type=$(b).find(".extype").val(),d.column=$(b).find(".column").val(),d.is_profile=$(b).find("i").hasClass("on")?1:0,c.push(d))}),d=c),$(".sgt tr:gt(0)").each(function(a,c){var d={},e=$(c).find(".sgtName").val(),f=$(c).find("input[type=hidden]").val();d.name=e,d.imgurl=f,b.push(d)});var e={location:a,type_id:$("#resId").val(),note:$("#note").val(),name:$("input[name=resName]").val(),owner:$("input[name=resOwner]").val(),mobile:$("input[name=resMobile]").val(),address:$("input[name=resAddress]").val(),logo:$("input[name=resLogo]").val(),license:$("input[name=license]").val(),topology:$("input[name=topology]").val(),tracepoint:$("input[name=tracepoint]").val(),fieldphoto:$("input[name=fieldphoto]").val(),schemes:JSON.stringify(d),plans:JSON.stringify(b)};resAjax("post",e,function(b){200==b.code?""==a?window.location.href="/index.html":window.location.href="/projectcard.html?location="+a:console.log(b)})}),$(document).on("click","#editRes",function(){var a=$("#location").val(),b=[];if(0==checkInput($(".veright"))){$(".sgt tr:gt(0)").each(function(a,c){var d={},e=$(c).find(".sgtName").val(),f=$(c).find("input[type=hidden]").val();d.name=e,d.imgurl=f,b.push(d)});var c={location:a,type_id:$("#resId").data("resid"),note:$("#note").val(),name:$("input[name=resName]").val(),owner:$("input[name=resOwner]").val(),mobile:$("input[name=resMobile]").val(),address:$("input[name=resAddress]").val(),logo:$("input[name=resLogo]").val(),license:$("input[name=license]").val(),topology:$("input[name=topology]").val(),tracepoint:$("input[name=tracepoint]").val(),fieldphoto:$("input[name=fieldphoto]").val(),plans:JSON.stringify(b)};resAjax("put",c,function(b){200==b.code?window.location.href="/projectcard.html?location="+a:console.log(b)})}}),$("#totallist .addbtn").click(function(){$("#modalUser").modal("open")}),$(document).on("click","#modalUser, #modalUser .closed",function(){$("#modalUser").modal("closed")});var userHtml=function(a,b,c,d,e,f){var g="<tr><td>"+a+"</td><td>"+e+"</td><td><span>"+c+"</span>"+f+'<input type="hidden" value="'+b+'" /></td><td>0</td><td>'+d+'</td><td>0</td><td>0</td><td><span class="changePwd">修改密码</span><span class="forbin">停用</span><span class="delete">删除</span><button type="button" class="btnGrayAutoMin save">保存</button><button type="button" class="btnGrayAutoMin cancel">取消</button><input type="hidden" value="'+a+'" </td></tr>';return g};$(document).on("click","#modalUser .add",function(){var a=$(".autoDom").attr("data-locate"),b=$(".autoDom").attr("title"),c=$("#exTime").val(),d=$("#password").val(),e=$("#expassword").val();return""==a?($(".msg").text("选择所属项目"),!1):d!=e?($(".msg").text("两次密码不相同"),!1):($(".msg").html(""),void $.ajax({method:"post",url:proUrl+"users/",dataType:"json",data:{project_id:a,expire_date:c,password:d},success:function(e){if(200==e.code){$("#modalUser").modal("closed");var f=userHtml(e.user,a,b,c,d,selop);$("#totallist table tr:eq(0)").after(f)}else console.log(e)},error:function(a){console.log(a)}}))}),$(document).on("click","#totallist .changePwd",function(){var a=$(this).parent().parent().find("td"),b='<input type="text" value="'+a.eq(1).data("value")+'" />';a.eq(1).html(b),a.eq(a.length-1).find("span").hide(),a.eq(a.length-1).find("button").show()}),$(document).on("click","#totallist .save",function(){var a=$(this).parent().parent().find("td"),b=a.eq(1).find("input").val(),c={user_id:$(this).parent().find("input").val(),password:b};userAjax("put",c,function(c){200==c.code?(a.eq(1).html('<em data-tip="'+b+'" class="pwdtip">***</em>'),a.eq(1).data("value",b),a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()):alert("修改密码失败！")})}),$(document).on("click","#totallist .cancel",function(){var a=$(this).parent().parent().find("td");a.eq(1).html('<em data-tip="'+a.eq(1).data("value")+'" class="pwdtip">***</em>'),a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}),$(document).on("click","#totallist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&userAjax("delete",{user:a.parent().find("input").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):alert("删除失败！")})}),$(document).on("click",".accountInfo .edit",function(){$trThis=$(this),$("#modalPassword").modal("open")}),$(document).on("click","#modalPassword, #modalPassword .closed",function(){$("#modalPassword").modal("closed")}),$(document).on("click","#modalPassword .save",function(){if(0==checkInput($("#modalPassword .vertical"))){var a=$("input[name=oldpwd]").val(),b=$("input[name=newpwd]").val(),c=$("input[name=new2pwd]").val();if(b!=c)return $("#modalPassword .msg").text("两次新密码不一致！"),!1;$("#modalPassword .msg").text("");var d={name:$trThis.data("value"),password:b,oldpassword:a};accountAjax("put",d,function(a){200==a.code?$("#modalPassword").modal("closed"):(console.log(a),$("#modalPassword .msg").text(a.reason))})}}),$(document).on("click","#accountlist .addbtn",function(){$("#modalAccount h3").text("新增账户"),$("#modalAccount .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalAccount .autoInput em").text("所属"),$("#modalAccount .autoInput").attr("data-locate",""),$("#modalAccount .autoInput").attr("title",""),$("#modalAccount li:eq(0) .verify").html('<input type="text" name="name" class="matchVerify shouldVerify" />'),$("#modalAccount li:eq(3) .verify input").addClass("shouldVerify"),$("#modalAccount").modal("open")}),$(document).on("click","#modalAccount, #modalAccount .closed",function(){$("#modalAccount").modal("closed")}),$(document).on("click","#modalAccount .add",function(a){var b=$("#modalAccount input[name=name]").val(),c=$("#modalAccount .autoInput").attr("data-locate"),d=($("#modalAccount .autoInput").attr("title"),$("#role option:selected").text(),$("#role").val()),e=$("#modalAccount input[name=password]").val();if(""==c)return $(".msg").text("选择所属项目"),!1;if($(".msg").text(""),0==checkInput($("#modalAccount .veright"))){var f={name:b,location:c,role:d,password:e};accountAjax("post",f,function(a){200==a.code?window.location.reload():$("#modalAccount .msg").text(a.reason)})}}),$(document).on("click","#accountlist .edit",function(){var a=$(this).parent().parent().index(),b=$(this).parent().parent().find("td");$("#modalAccount input[name=idx]").val(a),$("#modalAccount input[name=id]").val(b.eq(0).data("value")),$("#modalAccount li:eq(0) .verify").html(b.eq(0).data("value")),$("#modalAccount input[name=password]").removeClass("shouldVerify"),$("#modalAccount .autoInput em").text(b.eq(2).text()),$("#modalAccount .autoInput").attr("title",b.eq(2).text()),$("#modalAccount .autoInput").attr("data-locate",b.eq(2).data("value")),$("#modalAccount #role").val(b.eq(3).data("value")),$("#modalAccount h3").text("编辑账户"),$("#modalAccount .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),$("#modalAccount").modal("open")}),$(document).on("click","#modalAccount .save",function(a){var b=$("#modalAccount input[name=id]").val(),c=$("#modalAccount input[name=password]").val(),d=$("#modalAccount .autoInput").attr("data-locate"),e=($("#modalAccount .autoInput").attr("title"),$("#role").val());$("#role option:selected").text(),$("#modalAccount input[name=idx]").val();if(""==d)return $(".msg").text("选择所属项目"),!1;if($(".msg").text(""),0==checkInput($("#modalAccount .veright"))){var f={name:b,location:d,role:e};""!=c&&(f.password=c),accountAjax("put",f,function(a){200==a.code?window.location.reload():$("#modalAccount .msg").text(a.reason)})}}),$(document).on("click","#accountlist .forbin",function(){var a=$(this);confirm("确定停用该账户吗？")&&accountAjax("put",{name:$(this).siblings("input[name=name]").val(),mask:0},function(b){a.parent().parent().addClass("dab"),a.text("启用").addClass("unforbin").removeClass("forbin")})}),$(document).on("click","#accountlist .unforbin",function(){var a=$(this);accountAjax("put",{name:$(this).siblings("input[name=name]").val(),mask:1},function(b){a.parent().parent().removeClass("dab"),
a.text("停用").addClass("forbin").removeClass("unforbin")})}),$(document).on("click","#export",function(){var a={mask:$("#userlist .adsnav li.on").data("mask"),location:$("#location").val(),start:$(".time #dateStart").data("start"),end:$(".time #dateEnd").data("end"),keyword:$(".toolbox .search input").data("search"),sort:$("#userlist table").data("sort")};$(this).attr("href","/export/onlineusers/?"+$.param(a))}),$(document).on("click","#userlistInner .add",function(){$("#modalRoomInner").modal("open")}),$(document).on("click","#modalRoomInner, #modalRoomInner .closed",function(){$("#modalRoomInner").modal("closed")}),$(document).on("click","#userlistAccount .add",function(){$("#modalRoomAccount").modal("open")}),$(document).on("click","#modalRoomAccount, #modalRoomAccount .closed",function(){$("#modalRoomAccount").modal("closed")}),$(document).on("click","#userlistAccount .forbin",function(a){a.stopPropagation();var b=$(this),c=b.siblings("input.mask").val()|1<<30;confirm("确定要停用该用户吗？")&&userAccountAjax("put",$(this).siblings("input.id").val(),{mask:c},function(a){200==a.code?(b.siblings("input.mask").val(c),b.parent().parent().addClass("dab"),b.text("启用").addClass("unforbin").removeClass("forbin")):console.log(a)})}),$(document).on("click","#userlistAccount .unforbin",function(a){a.stopPropagation();var b=$(this),c=b.siblings("input.mask").val()&~(1<<30);userAccountAjax("put",$(this).siblings("input.id").val(),{mask:c},function(a){200==a.code?(b.siblings("input.mask").val(c),b.parent().parent().removeClass("dab"),b.text("停用").addClass("forbin").removeClass("unforbin")):console.log(a)})}),$(document).on("click","#userlistAccount .send",function(){var a=$(this).parents("tr"),b=$(this),c=a.find("td:eq(0)").text(),d=a.find("td:eq(1)").text(),e=a.find("td:eq(2)").data("tip");sendAccountAjax(c,{user:d,password:e},function(a){b.addClass("sendDis").removeClass("send"),alert("已发送!")},function(a){if(200==a.status)b.addClass("sendDis").removeClass("send"),alert("已发送!");else try{alert("发送失败："+a.responseJSON.Msg)}catch(c){alert("发送失败")}})}),$(document).on("click","#userlistPn .add",function(){$("#modalRoomPn").modal("open")}),$(document).on("click","#modalRoomPn, #modalRoomPn .closed",function(){$("#modalRoomPn").modal("closed")}),$(document).on("click","#userlistPn .forbin",function(a){a.stopPropagation();var b=$(this),c=$("#location").val(),d=$(this).siblings("input.id").val(),e=$(this).siblings("input.mask").val(),f={};f.mask=e|1<<30,confirm("确定要停用该用户吗？")&&userPnAjax("put",d,{location:c,params:JSON.stringify(f)},function(a){200==a.code?(b.siblings("input.mask").val(e),b.parent().parent().addClass("dab"),b.text("启用").addClass("unforbin").removeClass("forbin")):console.log(a)})}),$(document).on("click","#userlistPn .unforbin",function(a){a.stopPropagation();var b=$(this),c=$("#location").val(),d=$(this).siblings("input.id").val(),e=$(this).siblings("input.mask").val(),f={};f.mask=e&~(1<<30),userPnAjax("put",d,{location:c,params:JSON.stringify(f)},function(a){200==a.code?(b.siblings("input.mask").val(e),b.parent().parent().removeClass("dab"),b.text("停用").addClass("forbin").removeClass("unforbin")):console.log(a)})}),$(document).on("click","#userlistOnline .forbin, #apslist .siTable .forbin",function(a){a.stopPropagation();var b=$(this),c=b.siblings("input.mask").val()|1<<30;confirm("确定要停用该用户吗？")&&userOnlineAjax("put",$(this).siblings("input.id").val(),{mask:c,mac:$(this).siblings("input.mac").val()},function(a){200==a.code?(b.siblings("input.mask").val(c),b.parent().parent().addClass("dab"),b.text("启用").addClass("unforbin").removeClass("forbin")):console.log(a)})}),$(document).on("click","#userlistOnline .unforbin, #apslist .siTable .unforbin",function(a){a.stopPropagation();var b=$(this),c=b.siblings("input.mask").val()&~(1<<30);userOnlineAjax("put",$(this).siblings("input.id").val(),{mask:c,mac:$(this).siblings("input.mac").val()},function(a){200==a.code?(b.siblings("input.mask").val(c),b.parent().parent().removeClass("dab"),b.text("停用").addClass("forbin").removeClass("unforbin")):console.log(a)})}),$(document).on("click","#userlistGuest .forbin",function(a){a.stopPropagation();var b=$(this),c=b.siblings("input.mask").val()|1<<30;confirm("确定要停用该用户吗？")&&userGuestAjax("put",$(this).siblings("input.id").val(),{mask:c,mac:$(this).siblings("input.mac").val()},function(a){200==a.code?(b.siblings("input.mask").val(c),b.parent().parent().addClass("dab"),b.text("启用").addClass("unforbin").removeClass("forbin")):console.log(a)})}),$(document).on("click","#userlistGuest .unforbin",function(a){a.stopPropagation();var b=$(this),c=b.siblings("input.mask").val()&~(1<<30);userGuestAjax("put",$(this).siblings("input.id").val(),{mask:c,mac:$(this).siblings("input.mac").val()},function(a){200==a.code?(b.siblings("input.mask").val(c),b.parent().parent().removeClass("dab"),b.text("停用").addClass("forbin").removeClass("unforbin")):console.log(a)})}),$(document).on("click","#userlistOnline .adsnav li",function(){$(this).find("a").length>0||alert("开发中...")});var userinfoFlag=!0;$(document).on("click","#userinfoEdit",function(){userinfoFlag&&($(this).hide().siblings().show(),$(".sue").each(function(a,b){var c=$(b).data("value");if("ends"==$(b).attr("name"))var d='<div class="amount"><button type="button" class="btnWhiteSmall reduceOne">-</button><input type="text" value="'+c+'" /><button type="button" class="btnWhiteSmall addOne">+</button></div>';else if("datetime"==$(b).data("type"))var d='<div class="verify"><input type="text" value="'+c+'" class="datepicker" /></div>';else if("mobile"==$(b).attr("name"))var d='<div class="verify"><input type="text" class="matchVerify shouldVerify checkPhone" value="'+c+'" /></div>';else if("name"==$(b).attr("name"))var d='<div class="verify"><input type="text" class="matchVerify shouldVerify" value="'+c+'" /></div>';else if("mac"==$(b).attr("name"))var d='<div class="verify"><input type="text" class="matchVerify shouldVerify" value="'+c+'" /><span style="font-size:14px;color:#777">*MAC格式 xx:xx:xx:xx:xx:xx，以逗号(","）隔开多个MAC</span></div>';else if("password"==$(b).data("type")){$(b).removeClass("pwdtip");var d='<div class="verify"><input type="text" value="'+c+'" /></div>'}else if("img"==$(b).data("type"))$(b).find(".uploadify").show(),$(b).find("i").show();else var d='<div class="verify"><input type="text" value="'+c+'" /></div>';$(b).html(d)}),$(".datepicker").datetimepicker({dateFormat:"yy-mm-dd",stepMinute:10}),$(".amount").amount(),userinfoFlag=!1)}),$(document).on("click","#userinfoAccountSave",function(){if(!userinfoFlag){var a={},b=$(".widget input.id").val(),c=[];$(".sue").each(function(b,d){var e=$(d).attr("name"),f=$(d).data("type"),g={};"int"==f?a[e]=parseInt($(d).find("input").val()):"img"==f?a[e]=$(d).find(".imgShow").data("value"):a[e]=$(d).find("input").val(),g.type=f,g.value=a[e],c.push(g)}),0==checkInput($(".sue"))&&userAccountAjax("put",b,a,function(a){200==a.code?window.location.reload():console.log(a)})}}),$(document).on("click","#userinfoInnerSave",function(){if(!userinfoFlag){var a={},b=$(".widget input.id").val(),c=[];$(".sue").each(function(b,d){var e=$(d).attr("name"),f=$(d).data("type"),g={};"int"==f?a[e]=parseInt($(d).find("input").val()):"img"==f?a[e]=$(d).find(".imgShow").data("value"):a[e]=$(d).find("input").val(),g.type=f,g.value=a[e],c.push(g)}),0==checkInput($(".sue"))&&userInnerAjax("put",b,a,function(a){200==a.code?window.location.reload():console.log(a)})}}),$(document).on("click","#userinfoPaySave",function(){if(!userinfoFlag){var a={},b=$(".widget input.id").val(),c=[];$(".sue").each(function(b,d){var e=$(d).attr("name"),f=$(d).data("type"),g={};"int"==f?a[e]=parseInt($(d).find("input").val()):"img"==f?a[e]=$(d).find(".imgShow").data("value"):a[e]=$(d).find("input").val(),g.type=f,g.value=a[e],c.push(g)}),0==checkInput($(".sue"))&&userPayAjax("put",b,a,function(a){200==a.code?($.each(c,function(a,b){$(".sue").eq(a).data("value",b.value),"password"==b.type?$(".sue").eq(a).data("tip",b.value).addClass("pwdtip").text("***"):"img"==b.type?""!=b.value&&($(".sue").eq(a).find("i").hide(),$(".sue").eq(a).data("value",b.value),$(".sue").eq(a).find(".uploadify").hide()):$(".sue").eq(a).text(b.value)}),$(".userinfoSave").hide(),$("#userinfoQuit").hide(),$("#userinfoEdit").show(),userinfoFlag=!0):console.log(a)})}}),$(document).on("click","#userinfoPnSave",function(){if(!userinfoFlag){var a={},b={},c=$("#location").val(),d=$(".widget input.id").val(),e=[];$(".sue").each(function(b,c){var d=$(c).attr("name"),f=$(c).data("type"),g={};"int"==f?a[d]=parseInt($(c).find("input").val()):"img"==f?a[d]=$(c).find(".imgShow").data("value"):a[d]=$(c).find("input").val(),g.type=f,g.value=a[d],e.push(g)}),b.location=c,b.params=JSON.stringify(a),0==checkInput($(".sue"))&&userPnAjax("put",d,b,function(a){200==a.code?($.each(e,function(a,b){$(".sue").eq(a).data("value",b.value),"password"==b.type?$(".sue").eq(a).data("tip",b.value).addClass("pwdtip").text("***"):"img"==b.type?""!=b.value&&($(".sue").eq(a).find("i").hide(),$(".sue").eq(a).data("value",b.value),$(".sue").eq(a).find(".uploadify").hide()):$(".sue").eq(a).text(b.value)}),$(".userinfoSave").hide(),$("#userinfoQuit").hide(),$("#userinfoEdit").show(),userinfoFlag=!0):console.log(a)})}}),$(document).on("click","#userinfoQuit",function(){$(this).hide(),$(".userinfoSave").hide(),$("#userinfoEdit").show(),userinfoFlag=!0,$(".sue").each(function(a,b){var c=$(b).data("value");if("password"==$(b).data("type"))$(b).text("***"),$(b).addClass("pwdtip");else if("mac"==$(b).attr("name")){var d="",e=c.split(",");$.each(e,function(a,b){d+='<em class="bz">'+b+"</em>"}),$(b).html(d)}else if("img"==$(b).data("type")){$(b).find(".uploadify").hide();var f=c.split(","),g="";if(f.length>0)for(var h=0;h<f.length;h++)g+='<div><img src="'+f[h]+'" /><i></i></div>';$(b).find(".imgShow").html(g)}else $(b).text(c)})}),$(document).on("click",".imgShow i",function(){var a=$(this).parents(".imgShow"),b=a.data("value").split(","),c=$(this).parent().index();b.splice(c,1);for(var d=0,e="";d<b.length;d++)e=0==d?b[d]:e+","+b[d];a.data("value",e),$(this).parent().remove()}),$(document).on("click","#userCheck",function(){var a=$("#location").val(),b=$(this).siblings("input.id").val(),c=$(this).siblings("input.mask").val(),d={};d.mask=c|1<<25,userPnAjax("put",b,{location:a,params:JSON.stringify(d)},function(a){200==a.code&&(alert("审核成功！"),window.location.reload())},function(a){alert("审核失败！")})}),$(document).on("click","#userReback, #userlistPn table .reject",function(){$trThis=$(this),$("#modalReback").modal("open")}),$(document).on("click","#modalReback, #modalReback .closed",function(){$("#modalReback").modal("closed")}),$(document).on("click","#modalReback .add",function(){var a=$("#location").val(),b=$trThis.siblings("input.id").val(),c=$trThis.siblings("input.mask").val(),d={};d.mask=c&~(1<<25),0==checkInput($("#modalReback .veright"))&&userPnAjax("put",b,{location:a,params:JSON.stringify(d)},function(b){if(200==b.code){var c={location:a,mobile:$trThis.data("mobile"),title:"个人资料审核失败",text:$("input[name=reason]").val(),type:"system",create_notice:1,use_notificate:0,flag:"fail"};appPushAjax("post",c,function(a){200==a.code&&(alert("退回成功"),$("#modalReback").modal("closed"),$trThis.parent().find(".sta").length>0&&$trThis.parent().find(".sta").text("已驳回").attr("class","sta hasreject"))})}},function(a){alert("操作失败！")})}),$(document).on("click",".ns_bill .monthExport",function(){var a={location:$("#location").val(),start:$("#dateStart").val(),end:$("#dateEnd").val(),by_month:1};$(this).attr("href","/financial_report.xls?"+$.param(a))}),$(document).on("click",".ns_bill .allExport",function(){var a={location:$("#location").val(),start:$("#dateStart").val(),end:$("#dateEnd").val()};$(this).attr("href","/financial_report.xls?"+$.param(a))});var bill_webType=[],bill_fee=[],bill_platform=[];$(".bill_check span:eq(1), .bill_check span:eq(2), .bill_check span:eq(3)").each(function(i,n){$(n).find("em:gt(0)").each(function(i,n){var id=$(n).parent().attr("id"),arr=eval("bill_"+id);arr.push($(n).data("value"))})}),$(document).on("click","#webType em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length,c=$(this).data("value");0==a?($(this).addClass("on").siblings("em").removeClass("on"),bill_webType=[],$(this).parent().find("em:gt(0)").each(function(a,b){bill_webType.push($(b).data("value"))})):(0==b&&($(this).siblings("em:eq(0)").removeClass("on"),bill_webType=[]),$(this).hasClass("on")&&b>1?($(this).removeClass("on"),bill_webType.splice($.inArray(c,bill_webType),1)):($(this).addClass("on"),bill_webType.push(c)))}),$(document).on("click","#fee em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length,c=$(this).data("value");0==a?($(this).addClass("on").siblings("em").removeClass("on"),bill_fee=[],$(this).parent().find("em:gt(0)").each(function(a,b){bill_fee.push($(b).data("value"))})):(0==b&&($(this).siblings("em:eq(0)").removeClass("on"),bill_fee=[]),$(this).hasClass("on")&&b>1?($(this).removeClass("on"),bill_fee.splice($.inArray(c,bill_fee),1)):($(this).addClass("on"),bill_fee.push(c)))}),$(document).on("click","#platform em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length,c=$(this).data("value");0==a?($(this).addClass("on").siblings("em").removeClass("on"),bill_platform=[],$(this).parent().find("em:gt(0)").each(function(a,b){bill_platform.push($(b).data("value"))})):(0==b&&($(this).siblings("em:eq(0)").removeClass("on"),bill_platform=[]),$(this).hasClass("on")&&b>1?($(this).removeClass("on"),bill_platform.splice($.inArray(c,bill_platform),1)):($(this).addClass("on"),bill_platform.push(c)))}),$(document).on("click","#mode em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length;$(this).data("value");0==a?$(this).addClass("on").siblings("em").removeClass("on"):(0==b&&$(this).siblings("em:eq(0)").removeClass("on"),$(this).hasClass("on")&&b>1?$(this).removeClass("on"):$(this).addClass("on"))}),$(document).on("click","#billSearch",function(){var a={location:$("#location").val()};a.start=$("#dateStart").val(),a.end=$("#dateEnd").val(),bill_webType.length>0&&(a.web_type_id=bill_webType.join(",")),bill_fee.length>0&&(a.fee=bill_fee.join(",")),bill_platform.length>0&&(a.platform=bill_platform.join(",")),billFunc(a,function(a){200==a.code?($(".bill_total span:eq(0) em").text(a.current),$(".bill_total span:eq(1) em").text(a.last),$(".bill_total span:eq(2) em").text(a.total)):console.log(a)})});var checkXY=function(a,b,c,d){var e,f,g={},h=17;return a<h?e=0:a>c-h?(e=c-2*h,console.log(e)):e=a-h,f=b<h?0:b>d-h?d-2*h:b-h,g={cx:e,cy:f}},deAdd=!1,deEdit=!1,deThis,ccx,ccy,cid=-1,dotw=17,deImg,t_img,isLoad=!0,isImgLoad=function(a){$(".ns_dedo .deviceImg").each(function(a,b){if(0===this.height)return isLoad=!1,!1;var c=$(b).parent().height(),d=$(b).parent().width();$(b).parent().css({"margin-top":-Math.floor(c/2)+"px","margin-left":-Math.floor(d/2)+"px"})}),isLoad?(clearTimeout(t_img),a()):(isLoad=!0,t_img=setTimeout(function(){isImgLoad(a)},500))};isImgLoad(function(){console.log("加载完成！")});var devicedata=[];$(document).on("click",".deviceSel",function(a){a.stopPropagation(),$(".deviceSel").removeClass("on"),$(this).addClass("on"),$(this).parent().siblings().find(".deviceOp").hide(),$(this).next().toggle()}),$(document).on("click",".wrapper",function(){$(".deviceOp").hide()}),$(document).on("click",".deviceOp span",function(){$(".deviceOp span").removeClass("on"),$(this).addClass("on"),$(this).parent().hide(),$(".axy").animate({top:"-84px",opacity:0},500,"linear",function(){$(this).css("z-index",-1)}),$(".ns_xy").animate({height:"60px"},500),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),$(".ns_debtns").hide(),deAdd&&($(".donew").remove(),deAdd=!1),deEdit&&(deThis.parent().css({left:deThis.parent().data("left")+"px",top:deThis.parent().data("top")+"px"}),deEdit=!1);var a=$(this).data("id");$(".deviceImg").attr("src",a),isImgLoad(function(){console.log("加载"+a+"完成！")}),planAPAjax({imgurl:a},function(a){if($(".ns_dedo .dodot").remove(),200==a.code){var b="";$.each(a.aps,function(a,c){b+=0==c.online?'<i title="'+c.address+'" data-online="'+c.online+'" class="dodot doRed" data-x="'+c.pos_x+'" data-y="'+c.pos_y+'" style="left:'+c.left+"px; top:"+c.top+'px;">':1==c.is_sens?'<i title="'+c.address+'" data-online="'+c.online+'" class="dodot doBlue" data-x="'+c.pos_x+'" data-y="'+c.pos_y+'" style="left:'+c.left+"px; top:"+c.top+'px;">':'<i title="'+c.address+'" data-online="'+c.online+'" class="dodot doGreen" data-x="'+c.pos_x+'" data-y="'+c.pos_y+'" style="left:'+c.left+"px; top:"+c.top+'px;">',b+='<em class="doem" data-mac="'+c.mac+'" data-id="'+c._id+'"></em></i>'}),$(".ns_dedo").append(b)}})}),$(document).on("click","#addnav",function(){$("#modalDeviceName").modal("open")}),$(document).on("click","#modalDeviceName, #modalDeviceName .closed",function(){$("#modalDeviceName").modal("closed")}),$(document).on("click","#modalDeviceName .add",function(){if(0==checkInput($("#modalDeviceName .veright"))){var a=$("#modalDeviceName input[name=name]").val();planQvAjax("post",{name:a,location:$("#location").val()},function(b){if(200==b.code){var c='<div class="deviceNav"><div class="selIco deviceSel">'+a+'<i></i></div><div class="deviceOp"> <div><button type="button" class="btnGreenAutoMin add" data-groupId="'+b.group_id+'">上传图片</button></div> </div></div>';$("#addnav").before(c),5==$(".deviceNav").length&&$("#addnav").hide(),$("#modalDeviceName").modal("closed")}})}}),$(document).on("click",".axc .delete",function(){if(confirm("确定要删除该施工平面图吗？")){var a=$(".deviceOp span.on"),b={location:$("#location").val(),imgurl:a.data("id"),name:a.text(),group_id:a.parent().find(".add").data("groupid")};planImgAjax("delete",b,function(a){200==a.code?(alert("删除平面图成功！"),window.location.reload()):alert("删除失败！")})}}),$(document).on("click",".deviceOp .add",function(){deImg=$(this),$("#modalDeviceImg h3").text("新增施工平面图"),$("#modalDeviceImg .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalDeviceImg .file em").text(""),$("#modalDeviceImg").modal("open")}),$(document).on("click",".axc .edit",function(){var a=$(".deviceOp span.on"),b=a.text(),c=a.data("id");$("#modalDeviceImg input[name=name]").val(b),$("#modalDeviceImg .file input[type=hidden]").val(c),$("#modalDeviceImg .file em").text(c),$("#modalDeviceImg h3").text("编辑施工平面图"),$("#modalDeviceImg .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),$("#modalDeviceImg").modal("open")}),$(document).on("click","#modalDeviceImg, #modalDeviceImg .closed",function(){$("#modalDeviceImg").modal("closed")}),$(document).on("click","#modalDeviceImg .add",function(){if(0==checkInput($("#modalDeviceImg .veright"))){var a=$("#modalDeviceImg input[name=name]").val(),b=$("#modalDeviceImg .file input[type=hidden]").val(),c={name:a,group_id:deImg.attr("data-groupId"),imgurl:b};console.log(c),planImgAjax("post",c,function(c){if(200==c.code){var d='<span data-id="'+b+'">'+a+"</span>";deImg.parent().parent().append(d),$("#modalDeviceImg").modal("closed")}})}}),$(document).on("click","#modalDeviceImg .save",function(){if(0==checkInput($("#modalDeviceImg .veright"))){var a=$(".deviceOp span.on"),b=$("#modalDeviceImg input[name=name]").val(),c=$("#modalDeviceImg .file input[type=hidden]").val(),d={name:b,group_id:a.siblings("div").find("button").attr("data-groupId"),imgurl:c};console.log(d),planImgAjax("put",d,function(b){200==b.code&&(a.attr("data-id",c),$(".deviceImg").attr("src",c),isImgLoad(function(){console.log("加载"+c+"完成！")}),$("#modalDeviceImg").modal("closed"))})}}),$(document).on("click",".addap",function(){$(".ns_xy .add").show().siblings(".save").hide(),$(".axy").css("z-index",10).animate({top:"0",opacity:1},500),$(".ns_xy").animate({height:"80px"},500),deAdd=!0}),$(document).on("click",".ns_xy .quit",function(){$(".axy").animate({top:"-84px",opacity:0},500,"linear",function(){$(this).css("z-index",-1)}),$(".ns_xy").animate({height:"60px"},500),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),deAdd&&($(".donew").remove(),deAdd=!1),deEdit&&(deThis.parent().css({left:deThis.parent().data("left")+"px",top:deThis.parent().data("top")+"px"}),deEdit=!1)}),$(document).on("click",".ns_deCtx .deviceImg",function(a){$(".ns_debtns").remove();var b=a.offsetX,c=a.offsetY,d=$(this).parent().height(),e=$(this).parent().width();$("#ix").text(b),$("#iy").text(c);var f=checkXY(b,c,e,d);if(ccx=f.cx,ccy=f.cy,deAdd){$(".donew").remove();var g='<i class="dodot donew" data-online="1" data-left="'+ccx+'" data-top="'+ccy+'" style="left: '+ccx+"px;top: "+ccy+'px;"></i>';$(this).parent().append(g)}deEdit&&deThis.parent().css({left:ccx+"px",top:ccy+"px"})}),$(document).on("click",".ns_xy .add",function(){var a=($(".deviceNav li.on").index(),$(".ns_xy input[name=mac]").val()),b=$("#ix").text(),c=$("#iy").text();if(""==b||""==c)return alert("请点击施工图获取AP坐标"),!1;if(0==checkInput($(".ns_xy span"))){var d={location:$("#location").val(),imgurl:$(".ns_dedo .deviceImg").attr("src"),mac:a,pos_x:b,pos_y:c,left:$(".donew").data("left"),top:$(".donew").data("top")};planAjax("post","",d,function(d){if(200==d.code){var e='<em class="doem" data-mac="'+a+'" data-x="'+b+'" data-y="'+c+'" data-id="'+d.ap_id+'"></em>';$(".donew").html(e).addClass("doGreen").removeClass("donew"),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),alert("新增成功！")}else 500==d.code?alert("Error:"+d.reason):console.log(d)})}}),$(document).on("click",".ns_debtns .edit",function(){$(".ns_debtns").remove(),$(".donew").remove(),$(".ns_xy .save").show().siblings(".add").hide(),$(".axy").css("z-index",10).animate({top:"0",opacity:1},500),$(".ns_xy").animate({height:"80px"},500),$(".ns_xy input[name=mac]").val(deThis.data("mac")),$("#ix").text(deThis.data("x")),$("#iy").text(deThis.data("y")),deAdd=!1,deEdit=!0}),$(document).on("click",".ns_xy .save",function(){var a=$(".ns_xy input[name=mac]").val(),b=$("#ix").text(),c=$("#iy").text();if(0==checkInput($(".ns_xy span"))){var d={mac:a,pos_x:b,pos_y:c,left:ccx,top:ccy};planAjax("put",deThis.data("id"),d,function(d){200==d.code?(alert("编辑成功！"),deThis.data("mac",a),deThis.data("x",b),deThis.data("y",c),deThis.parent().data("left",ccx),deThis.parent().data("top",ccy),$(".axy").animate({top:"-84px",opacity:0},500,"linear",function(){$(this).css("z-index",-1)}),$(".ns_xy").animate({height:"60px"},500),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),deEdit=!1):console.log(d)})}}),$(document).on("click",".ns_debtns .delete",function(){confirm("确定要删除此AP？")&&planAjax("delete",deThis.data("id"),"",function(a){200==a.code?(deThis.parent().remove(),$(".ns_debtns").remove()):console.log(a)})});var deoffset2=[{top:22,left:122},{top:0,left:71},{top:22,left:22},{top:71,left:0},{top:122,left:22},{top:142,left:71},{top:122,left:122},{top:71,left:142},{top:76,left:152}],sens2Func=function(a,b){var c=$("#location").val(),d={location:c,ap_mac:b.data("mac"),page:a,page_size:5};planMemberAjax("get",d,function(b){if(200==b.code){$(".ns_deinfo h5 span").html("("+b.address+")");for(var d=b.members,e=0,f="";e<d.length;e++)f+='<li><a href="/projectsensmember.html?location='+c+"&sta_mac="+d[e].sta_mac+"&ap_mac="+d[e].ap_mac+'" title="'+d[e].name+'"><span class="name"><em class="off"></em><p>'+d[e].name+"</p></span></a></li>";$(".ns_deinfo ul.bbody").html(f),$(".ns_page").data("page",a),$(".devicelinkPrev, .devicelinkNext").hide(),a<b.page_count&&$(".devicelinkNext").show(),a>1&&$(".devicelinkPrev").show()}})},sensFunc=function(a,b){var c=$("#location").val(),d={location:c,ap_mac:a,page:b};planMemberAjax("get",d,function(d){if(200==d.code){for(var e=d.members,f=0,g="";f<e.length;f++)g+='<span class="new"><a href="/projectsensmember.html?location='+c+"&sta_mac="+e[f]._id.sta_mac+"&ap_mac="+e[f]._id.ap_mac+'" title="'+e[f].name+'"><img src="'+e[f].photo+'" /></a></span>';!$(".sensbtn").length>0&&(g+='<span class="sensbtn new"><button type="button" data-mac="'+a+'" data-page="'+b+'"><em class="arrowNext"></em></button></span>'),$(".ns_circle").append(g),b==d.page_count&&$(".sensbtn button").attr("disabled",!0),$(".ns_circle .new").each(function(a,b){$(b).hasClass("sensbtn")?$(b).animate({opacity:1,top:deoffset2[8].top+"px",left:deoffset2[8].left+"px",width:"32px",height:"32px"}).removeClass("new"):$(b).animate({opacity:1,top:deoffset2[a].top+"px",left:deoffset2[a].left+"px",width:"42px",height:"42px"}).addClass("old").removeClass("new")})}})};$(document).on("mouseenter",".ns_dedo .doBlue .doem",function(a){a.stopPropagation(),deThis=$(this),sens2Func(1,deThis);var b=$(".ns_deinfo").outerWidth(),c=$(".ns_deinfo").outerHeight(),d=deThis.parent().position().left+dotw,e=deThis.parent().position().top+dotw,f=(deThis.parent().parent().height(),deThis.parent().parent().width());d<b?($(".ns_deinfo").css({left:"1px"}),$(".ns_deinfo .arrow").css({left:d+"px"})):d>f-b?($(".ns_deinfo").css({left:f-b-1+"px"}),$(".ns_deinfo .arrow").css({left:b-(f-d)+"px"})):($(".ns_deinfo").css({left:d-b/2+"px"}),$(".ns_deinfo .arrow").css({left:"50%"})),e<c?($(".ns_deinfo").css({top:e+dotw+"px","box-shadow":"0 4px 8px rgba(205, 205, 205, 0.8)"}),$(".ns_deinfo .arrow").css({top:"-10px"}).removeClass("down")):($(".ns_deinfo").css({top:e-c-dotw+"px","box-shadow":"0 -4px 8px rgba(205, 205, 205, 0.8)"}),$(".ns_deinfo .arrow").css({top:c-2+"px"}).addClass("down")),$(".ns_deinfo").show()}),$(document).on("click",".devicelinkPrev",function(){var a=$(".ns_page").data("page");a--,sens2Func(a,deThis)}),$(document).on("click",".devicelinkNext",function(){var a=$(".ns_page").data("page");a++,sens2Func(a,deThis)}),$(document).on("mouseover",".ns_dedo .ns_deinfo, .ns_dedo .ns_circle",function(a){a.stopPropagation()}),$(document).on("mouseover",".ns_device",function(){$(".ns_deinfo .bbody").html(""),$(".ns_deinfo").hide()}),$(document).on("click",".ns_dedo .doem",function(){if(!deEdit){var a=!!$(this).parent().hasClass("doBlue");if(cid==$(this).data("id")&&$(".ns_debtns").length>0)return $(".ns_debtns").remove(),!1;$(".ns_debtns").remove(),deThis=$(this),cid=deThis.data("id");var b=$("#location").val(),c=deThis.data("mac"),d=$(this).parent().position().left+dotw,e=$(this).parent().position().top+dotw,f=$(this).parent().parent().height(),g=$(this).parent().parent().width(),h='<div class="ns_debtns"><i class="arrow"></i><div><button type="button" class="btnBlueSmall edit">编辑</button><button type="button" class="btnBlueSmall delete">删除</button><a href="/projectsensgroup.html?location='+b+"&ap_mac="+c+'" class="btnBlueSmall" target="_blank">查看</a>';h+=a?'<button type="button" class="btnBlueSmall sensEnable" data-value="1">关闭感知</button>':'<button type="button" class="btnBlueSmall sensEnable" data-value="0">开启感知</button>',h+="</div></div>",$(this).parent().parent().append(h);var i=$(".ns_debtns").outerWidth(),h=$(".ns_debtns").outerHeight();d<Math.floor(g/2)?$(".ns_debtns").css({left:d+dotw+"px"}):($(".ns_debtns").css({left:d-i-dotw+"px"}),$(".ns_debtns .arrow").css({left:i-2+"px"}).addClass("right")),e<h/2?($(".ns_debtns").css({top:0}),$(".ns_debtns .arrow").css({top:e+"px"})):e>f-h?($(".ns_debtns").css({top:f-h+"px"}),$(".ns_debtns .arrow").css({top:h-(f-e)+"px"})):$(".ns_debtns").css({top:e-h/2+"px"})}}),$(document).on("click",".ns_debtns .sensEnable",function(){var a=$(this),b=$(this).data("value")?0:1,c={mac:deThis.data("mac"),sens:b};console.log(c),planEnableAjax("put",c,function(c){if(200==c.code){console.log(deThis);var d=deThis.parent();b?(a.text("关闭感知").data("value",1),d.addClass("doBlue"),0==d.data("online")?d.removeClass("doRed"):d.removeClass("doGreen")):(a.text("开启感知").data("value",0),0==d.data("online")?d.addClass("doRed"):d.addClass("doGreen"),d.removeClass("doBlue"))}})}),$(document).on("click",".ns_portal .adsnav li",function(){var a=$(this).index();$(this).addClass("on").siblings().removeClass("on"),$(".pt_area").eq(a).show().siblings().hide()}),$(document).on("click","#portallist .addbtn",function(){$("#modalPortal h3").text("新增Portal"),$("#modalPortal .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalPortal").modal("open")}),$(document).on("click","#portallist .edit",function(){var a=($(this),$(this).siblings("input").val());$("#modalPortal input[name=name]").val(a),$("#modalPortal input[name=id]").val(a),$("#modalPortal h3").text("修改Portal模板名称"),$("#modalPortal .btngroups").html('<button type="button" class="btnBlue edit">保存</button>'),$("#modalPortal").modal("open")}),$(document).on("click","#modalPortal, #modalPortal .closed",function(){$("#modalPortal").modal("closed")}),$(document).on("click","#modalPortal .add",function(){if(0==checkInput($("#modalPortal .veright"))){var a={name:$("#modalPortal input[name=name]").val()};portalAjax("post","",a,function(a){200==a.Code?window.location.reload():(console.log(a),alert("新增portal失败！"))})}}),$(document).on("click","#modalPortal .edit",function(){0==checkInput($("#modalPortal .veright"))&&portalAjax("put","?name="+$("#modalPortal input[name=name]").val(),"",function(a){200==a.Code?window.location.reload():(console.log(a),alert("修改portal模板名称失败！"))})}),$(document).on("click","#modalQrcode, #modalQrcode .closed",function(){$("#modalQrcode").modal("closed")}),$(document).on("click","#portallist .forbin",function(){var a=($(this),{id:$(this).siblings("input[type=hidden]").val(),name:$(this).parent().parent().find("td:eq(0)").text(),location:$("#location").val(),mask:0});portalAjax("put",a,function(a){200==a.code?window.location.reload():console.log(a)})}),$(document).on("click","#portallist .unforbin",function(){if(confirm("确定要启用该模板吗？")){var a={id:$(this).siblings("input[type=hidden]").val(),name:$(this).parent().parent().find("td:eq(0)").text(),location:$("#location").val(),mask:1};portalAjax("put",a,function(a){200==a.code?window.location.reload():console.log(a)})}}),$(document).on("click","#portallist .delete",function(){var a=$(this);confirm("确定模板没有在使用？")&&portalAjax("DELETE",a.siblings("input").val(),"",function(b){200==b.Code?a.parent().parent().fadeOut(function(){$(this).remove()}):(console.log(b),alert("删除失败"))},function(a){console.log(a),alert("删除失败")})}),$(document).on("mouseenter",".zz",function(){$(this).find(".pt_zz").show()}),$(document).on("mouseleave",".pt_zz",function(){$(this).hide()}),$(document).on("click",".pt_h5 .pt_del",function(){var a=$(this).parent().parent().index();$(this).parent().parent().hide(),resizeZW(),$(".h5case span").eq(a).addClass("undo")}),$(document).on("click",".pt_pc .pt_del",function(){var a=$(this).parent().parent().index();$(this).parent().parent().hide(),$(".pccase span").eq(a).addClass("undo")}),$(document).on("click",".pt_h5 .undo",function(){var a=$(this).index();a<3&&($(".pt_h5 .zz").eq(a).show(),resizeZW(),$(this).removeClass("undo"))}),$(document).on("click",".pt_pc .undo",function(){var a=$(this).index();$(".pt_pc .zz").eq(a).show(),$(this).removeClass("undo")}),$(document).on("mouseenter",".pt_h5 h1 span, .pt_pc h1 span",function(){$(this).siblings(".pt_tip").show()}),$(document).on("mouseleave",".pt_h5 h1 span, .pt_pc h1 span",function(){$(this).siblings(".pt_tip").hide()}),$(document).on("click",".pt_h5 h1 span, .pt_pc h1 span",function(){var a=$(this).text();$(this).hide().siblings("input").val(a).show().focus()}),$(document).on("blur",".pt_h5 h1 input",function(){var a=$(this).val();$(this).hide().siblings("span").text(a),""==a?$(this).hide().siblings("p").show():$(this).siblings("span").show()}),$(document).on("blur",".pt_pc h1 input",function(){var a=$(this).val();a=""==a?"南沙无线城市":a,$(this).hide().siblings("span").text(a).show()}),$(document).on("click",".pt_h5 h1 p",function(){$(this).hide().siblings("input").show().focus()}),$(document).on("change","#h5bg, #pcbg",function(){wnlajaxImgThd($(this).attr("id"))}),$(document).on("change",".pt_pc #direction",function(){"top"==$(this).val()?$(".pt_pc .pBar").removeClass("pbtm"):$(".pt_pc .pBar").addClass("pbtm");
}),$(document).on("click","#H5preview",function(){var a=[];$(".h5case span").each(function(b,c){$(c).hasClass("undo")||a.push($(c).data("way"))});var b={location:$("#location").val(),type:"h5",title:$(".pt_h5 h1 span").text(),pic:$("input[name=h5bg]").val(),way:JSON.stringify(a)};portalAjax("get",b,function(a){if(200==a.code){var b=window.location.protocol+"//"+window.location.hostname+"/portal/preview/?preview_id="+a.preview_id,c=qrgen.canvas({data:b,cellSize:"5"});$("#qrcode").html(c)}}),$("#modalQrcode").modal("open")}),$(document).on("click","#H5save",function(){var a=[];$(".h5case span").each(function(b,c){$(c).hasClass("undo")||a.push($(c).data("way"))});var b=getParam("name"),c={type:"h5",title:$(".pt_h5 h1 span").text(),pic:$("input[name=h5bg]").val()};portalAjax("put",b,c,function(a){200==a.Code?(alert("保存成功！"),window.location.reload()):(console.log(a),alert("保存失败！"))})}),$(document).on("click","#PCpreview",function(){var a=[];$(".pccase span").each(function(b,c){$(c).hasClass("undo")||a.push($(c).data("way"))});var b={location:$("#location").val(),type:"pc",title:$(".pt_pc h1 span").text(),pic:$("input[name=pcbg]").val(),way:JSON.stringify(a),nav:$("#direction").val()};portalAjax("get",b,function(a){if(200==a.code){var b=window.location.protocol+"//"+window.location.host+"/portal/preview/?preview_id="+a.preview_id;window.open(b)}})}),$(document).on("click","#PCsave",function(){var a=[];$(".pccase span").each(function(b,c){$(c).hasClass("undo")||a.push($(c).data("way"))});var b=getParam("name"),c={type:"pc",title:$(".pt_pc h1 span").text(),pic:$("input[name=pcbg]").val()};portalAjax("put",b,c,function(a){200==a.Code?(alert("保存成功！"),window.location.reload()):(console.log(a),alert("保存失败！"))})})}),window.onload=function(){removeLoad()},function(a){a.fn.extend({modal:function(a){var c=this;b(c,a)}});var b=function(b,c){"open"==c?(a("body").css("padding-right","17px").addClass("modal_open").append('<div class="zhez fade"></div>'),a(b).fadeIn(150,function(){a(this).addClass("in")}),a(".zhez").addClass("in")):"closed"==c&&(a(b).removeClass("in").fadeOut(150),a(b).find("input").each(function(b,c){a(c).val(""),inputError("",c)}),a(b).find(".loading").hide(),a(".amount input").val(2),a(b).find(".msg").text(""),a(".zhez").removeClass("in"),setTimeout(function(){a(".zhez").remove(),a("body").css("padding-right","0").removeClass("modal_open")},150))};a(document).on("click",".modal .modal_body, .modal .modal_ele img",function(a){a.stopPropagation()})}(jQuery),function(a){a.fn.amount=function(b){var c=a(this),d={init:function(b){var d={min:1,max:5};this.wrapper=c,this.settings=a.extend(d,b||{}),this.ipu=this.wrapper.find("input"),this.addEvent(),this.reduceEvent(),this.modifyEvent()},addEvent:function(){var a=this;this.wrapper.find(".addOne").on("click",function(){a.val=a.wrapper.find("input").val();var b=a.amountFunc(a.val,!0);b>a.settings.max?a.ipu.val(a.settings.max):a.ipu.val(b)})},reduceEvent:function(){var a=this;this.wrapper.find(".reduceOne").on("click",function(){a.val=a.wrapper.find("input").val();var b=a.amountFunc(a.val,!1);b<a.settings.min?a.ipu.val(a.settings.min):a.ipu.val(b)})},modifyEvent:function(){var a=this;this.ipu.on("change",function(){a.val=a.wrapper.find("input").val(),(!a.reg(a.val)||a.val>a.settings.max||a.val<a.settings.min)&&(alert("仅可支持1-5个终端数"),a.ipu.val(2))})},amountFunc:function(a,b){return this.reg(a)&&(b?a++:a--),a},reg:function(a){return new RegExp("^[0-9]*$").test(a)}};d.init(b)}}(jQuery);
/*! nanshacity JavieChan */